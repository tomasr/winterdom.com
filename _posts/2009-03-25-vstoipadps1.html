---
layout: post
status: publish
published: true
title: vstoipad.ps1
author:
  display_name: Tomas Restrepo
  login: tomasr
  email: tomas@winterdom.com
  url: http://winterdom.com/
author_login: tomasr
author_email: tomas@winterdom.com
author_url: http://winterdom.com/
wordpress_id: 30
wordpress_url: http://winterdom.com/2009/03/vstoipadps1
date: '2009-03-25 18:30:43 +0000'
date_gmt: '2009-03-25 18:30:43 +0000'
categories:
- PowerShell
- Oslo
tags: []
comments:
- id: 27
  author: Zuhaib
  author_email: zuhaib@zuhaib.in
  author_url: http://www.zuhaib.in/
  date: '2009-04-01 01:26:57 +0000'
  date_gmt: '2009-04-01 01:26:57 +0000'
  content: |
    Is this color scheme available for VS 2008?
- id: 28
  author: Tomas Restrepo
  author_email: tomas@winterdom.com
  author_url: http://winterdom.com
  date: '2009-04-02 16:05:33 +0000'
  date_gmt: '2009-04-02 16:05:33 +0000'
  content: |
    Yes, it's in the pages I referenced.
- id: 1151
  author: Dan Bernier
  author_email: danbernier@gmail.com
  author_url: http://invisibleblocks.wordpress.com
  date: '2009-10-05 17:02:17 +0000'
  date_gmt: '2009-10-05 17:02:17 +0000'
  content: 'I''m working on something similar, and also figured out the colors are
    in BGR, not RGB.  But what''s with the leading bits?  Full blue, for instance,
    would be #FF0000, not #0000FF, but it seems to be #00FF0000.  Based on only a
    few datapoints, they seem to be 0x02 for non-editable properties, and 0x00 for
    editable ones.  Any ideas?'
- id: 1865
  author: Jared B.
  author_email: tractarian72@hotmail.com
  author_url: ''
  date: '2012-01-09 19:20:27 +0000'
  date_gmt: '2012-01-09 19:20:27 +0000'
  content: http:&#47;&#47;stackoverflow.com&#47;a&#47;8005352&#47;241201 suggests
    that the first two digits are the alpha channel...not sure how to test out that
    theory though...
---
<p><!--start_raw-->
<p>Here&rsquo;s a downright ugly, but somewhat useful script to generate a <a href="http:&#47;&#47;winterdom.com&#47;weblog&#47;2009&#47;03&#47;24&#47;DarkIntellipad.aspx">ClassificationFormats.xcml</a> file for the Intellipad editor in the Oslo SDK from a *.vssettings file exported from Visual Studio 2008.</p>
<p>This should work on a reasonably complete exported Visual Studio color scheme, such as the ones I have <a href="http:&#47;&#47;winterdom.com&#47;weblog&#47;CategoryView,category,VSColorScheme.aspx">posted in the past</a>.</p>
<div class="codebg"><code> <span class="Keyword">param</span>(<span class="Type">[string]</span><span class="Identifier">$vsfile</span>, <span class="Type">[string]</span><span class="Identifier">$outdir</span>, <span class="Type">[bool]</span><span class="Identifier">$boldAsItalics</span>&nbsp;= <span class="Boolean">$true</span>)<br &#47;> <br &#47;> <span class="Identifier">$ns_x</span>&nbsp;= <span class="String">'<a href="http:&#47;&#47;schemas.microsoft.com&#47;winfx&#47;2006&#47;xaml">http:&#47;&#47;schemas.microsoft.com&#47;winfx&#47;2006&#47;xaml</a>'</span><br &#47;> <span class="Identifier">$ns_act</span>&nbsp;= <span class="String">'clr-namespace:System.ComponentModel.Activation;assembly=Activation'</span><br &#47;> <span class="Identifier">$ns_ls</span>&nbsp;= <span class="String">'clr-namespace:Microsoft.Intellipad.LanguageServices;assembly=Microsoft.Intellipad.Core'</span><br &#47;> <br &#47;> <span class="Keyword">function</span>&nbsp;<span class="Function">color</span>(<span class="Identifier">$vscolor</span>) {<br &#47;> &nbsp;&nbsp; <span class="Conditional">if</span>&nbsp;( <span class="Identifier">$vscolor</span>.StartsWith(<span class="String">'0x02'</span>) ) {<br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Keyword">return</span>&nbsp;<span class="Constant">$null</span><br &#47;> &nbsp;&nbsp; } <span class="Conditional">else</span>&nbsp;{<br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Identifier">$rgb</span>&nbsp;= <span class="Identifier">$vscolor</span>.substring(<span class="Number">4</span>,<span class="Number">6</span>)<br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Identifier">$red</span>&nbsp;= <span class="Identifier">$rgb</span>.substring(<span class="Number">4</span>,<span class="Number">2</span>)<br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Identifier">$green</span>&nbsp;= <span class="Identifier">$rgb</span>.substring(<span class="Number">2</span>,<span class="Number">2</span>)<br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Identifier">$blue</span>&nbsp;= <span class="Identifier">$rgb</span>.substring(<span class="Number">0</span>,<span class="Number">2</span>)<br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Keyword">return</span>&nbsp;<span class="String">"#FF</span><span class="Identifier">$red$green$blue</span><span class="String">"</span><br &#47;> &nbsp;&nbsp; }<br &#47;> }<br &#47;> <span class="Keyword">function</span>&nbsp;<span class="Function">write-color</span>(<span class="Identifier">$writer</span>, <span class="Identifier">$where</span>, <span class="Identifier">$color</span>) {<br &#47;> &nbsp;&nbsp; <span class="Conditional">if</span>&nbsp;( <span class="Identifier">$color</span>&nbsp;-<span class="Operator">ne</span>&nbsp;<span class="Constant">$null</span>&nbsp;) {<br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Identifier">$writer</span>.WriteAttributeString(<span class="Identifier">$where</span>, <span class="Identifier">$color</span>)<br &#47;> &nbsp;&nbsp; }<br &#47;> }<br &#47;> <span class="Keyword">function</span>&nbsp;<span class="Function">fix-font</span>(<span class="Type">[int]</span><span class="Identifier">$fontSize</span>) {<br &#47;> &nbsp;&nbsp; <span class="Comment"># font size in VS is in pts</span><br &#47;> &nbsp;&nbsp; <span class="Comment"># but intellipad uses px right now, more or less</span><br &#47;> &nbsp;&nbsp; <span class="Keyword">return</span>&nbsp;<span class="Type">[int]</span>(<span class="Identifier">$fontSize</span>&nbsp;* <span class="Number">4</span>&nbsp;&#47; <span class="Number">3</span>.<span class="Number">25</span>)<br &#47;> }<br &#47;> <span class="Keyword">function</span>&nbsp;<span class="Function">convertto-ipad</span>(<span class="Identifier">$item</span>, <span class="Identifier">$name</span>, <span class="Identifier">$writer</span>) {<br &#47;> &nbsp;&nbsp; <span class="Identifier">$writer</span>.WriteStartElement(<span class="String">'act'</span>, <span class="String">'Export'</span>, <span class="Identifier">$ns_act</span>)<br &#47;> &nbsp;&nbsp; <span class="Identifier">$writer</span>.WriteAttributeString(<span class="String">'Name'</span>, <span class="String">'{}{Microsoft.Intellipad}ClassificationFormat'</span>)<br &#47;> &nbsp;&nbsp; <span class="Identifier">$item</span><br &#47;> &nbsp;&nbsp; <span class="Identifier">$writer</span>.WriteStartElement(<span class="String">'ls'</span>, <span class="String">'ClassificationFormat'</span>, <span class="Identifier">$ns_ls</span>)<br &#47;> &nbsp;&nbsp; <span class="Identifier">$writer</span>.WriteAttributeString(<span class="String">'Name'</span>, <span class="Identifier">$name</span>)<br &#47;> &nbsp;&nbsp; <span class="Identifier">$writer</span>.WriteAttributeString(<span class="String">'FontSize'</span>, <span class="Identifier">$fontSize</span>)<br &#47;> &nbsp;&nbsp; <span class="Identifier">$writer</span>.WriteAttributeString(<span class="String">'FontFamily'</span>, <span class="Identifier">$fontFamily</span>)<br &#47;> &nbsp;&nbsp; <span class="Statement">write-color</span>&nbsp;<span class="Identifier">$writer</span>&nbsp;<span class="String">'Foreground'</span>&nbsp;(color <span class="Identifier">$item</span>.Foreground)<br &#47;> &nbsp;&nbsp; <span class="Statement">write-color</span>&nbsp;<span class="Identifier">$writer</span>&nbsp;<span class="String">'Background'</span>&nbsp;(color <span class="Identifier">$item</span>.Background)<br &#47;> &nbsp;&nbsp; <span class="Conditional">if</span>&nbsp;( <span class="Identifier">$item</span>.BoldFont -<span class="Operator">eq</span>&nbsp;<span class="String">'yes'</span>&nbsp;) {<br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Conditional">if</span>&nbsp;( <span class="Identifier">$boldAsItalics</span>&nbsp;) {<br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="Identifier">$writer</span>.WriteAttributeString(<span class="String">'FontStyle'</span>, <span class="String">'Italic'</span>)<br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <span class="Conditional">else</span>&nbsp;{<br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="Identifier">$writer</span>.WriteAttributeString(<span class="String">'FontWeight'</span>, <span class="String">'Bold'</span>)<br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br &#47;> &nbsp;&nbsp; }<br &#47;> &nbsp;&nbsp; <span class="Identifier">$writer</span>.WriteEndElement()<br &#47;> &nbsp;&nbsp; <span class="Identifier">$writer</span>.WriteEndElement()<br &#47;> }<br &#47;> <span class="Keyword">function</span>&nbsp;<span class="Function">find</span>(<span class="Identifier">$items</span>, <span class="Identifier">$name</span>) {<br &#47;> &nbsp;&nbsp; <span class="Repeat">foreach</span>&nbsp;( <span class="Identifier">$item</span>&nbsp;<span class="Keyword">in</span>&nbsp;<span class="Identifier">$items</span>&nbsp;) {<br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Conditional">if</span>&nbsp;( <span class="Identifier">$item</span>.Name -<span class="Operator">eq</span>&nbsp;<span class="Identifier">$name</span>&nbsp;) {<br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="Keyword">return</span>&nbsp;<span class="Identifier">$item</span><br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="Repeat">break</span><br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br &#47;> &nbsp;&nbsp; }<br &#47;> }<br &#47;> <br &#47;> <span class="Identifier">$xml</span>&nbsp;= <span class="Type">[xml]</span>(gc <span class="Identifier">$vsfile</span>);<br &#47;> <span class="Identifier">$cat</span>&nbsp;= <span class="Identifier">$xml</span>.SelectSingleNode(<span class="String">"&#47;&#47;Category[@GUID='{A27B4E24-A735-4D1D-B8E7-9716E1E3D8E0}']"</span>)<br &#47;> <span class="Identifier">$fontSize</span>&nbsp;= <span class="Statement">fix-font</span>(<span class="Identifier">$cat</span>.<br />
FontSize)<br &#47;> <span class="Identifier">$fontFamily</span>&nbsp;= <span class="Identifier">$cat</span>.FontName<br &#47;> <span class="Conditional">if</span>&nbsp;( <span class="Identifier">$fontFamily</span>.EndsWith(<span class="String">'VS'</span>) ) {<br &#47;> &nbsp;&nbsp; <span class="Identifier">$fontFamily</span>&nbsp;= <span class="Identifier">$fontFamily</span>.Substring(<span class="Number">0</span>, <span class="Identifier">$fontFamily</span>.Length -&nbsp;<span class="Number">3</span>)<br &#47;> }<br &#47;> <span class="Identifier">$items</span>&nbsp;= <span class="Identifier">$cat</span>.SelectNodes(<span class="String">"Items&#47;Item"</span>)<br &#47;> <br &#47;> <span class="Identifier">$ipadfile</span>&nbsp;= <span class="String">"</span><span class="Delimiter">$(</span><span class="Statement">resolve-path</span>&nbsp;<span class="Identifier">$outdir</span><span class="Delimiter">)</span><span class="String">\ClassificationFormats.xcml"</span><br &#47;> <span class="Identifier">$writer</span>&nbsp;= <span class="Type">[xml.xmlwriter]</span>::Create(<span class="Identifier">$ipadfile</span>);<br &#47;> <br &#47;> <span class="Keyword">trap</span>&nbsp;{<br &#47;> &nbsp;&nbsp; <span class="Conditional">if</span>&nbsp;( <span class="Identifier">$writer</span>&nbsp;-<span class="Operator">ne</span>&nbsp;<span class="Constant">$null</span>&nbsp;) {<br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Identifier">$writer</span>.Close()<br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Keyword">throw</span>&nbsp;<span class="StorageClass">$error</span><br &#47;> &nbsp;&nbsp; }<br &#47;> }<br &#47;> <br &#47;> <span class="Identifier">$writer</span>.WriteStartElement(<span class="String">'act'</span>, <span class="String">'Exports'</span>, <span class="Identifier">$ns_act</span>)<br &#47;> <span class="Identifier">$writer</span>.WriteAttributeString(<span class="String">'xmlns'</span>, <span class="String">'ls'</span>, <span class="String">''</span>, <span class="Identifier">$ns_ls</span>)<br &#47;> <span class="Statement">convertto-ipad</span>&nbsp;(find <span class="Identifier">$items</span>&nbsp;<span class="String">'Plain Text'</span>) <span class="String">'text'</span>&nbsp;<span class="Identifier">$writer</span><br &#47;> <span class="Statement">convertto-ipad</span>&nbsp;(find <span class="Identifier">$items</span>&nbsp;<span class="String">'Plain Text'</span>) <span class="String">'Unknown'</span>&nbsp;<span class="Identifier">$writer</span><br &#47;> <span class="Statement">convertto-ipad</span>&nbsp;(find <span class="Identifier">$items</span>&nbsp;<span class="String">'Number'</span>) <span class="String">'Numeric'</span>&nbsp;<span class="Identifier">$writer</span><br &#47;> <span class="Statement">convertto-ipad</span>&nbsp;(find <span class="Identifier">$items</span>&nbsp;<span class="String">'Keyword'</span>) <span class="String">'Keyword'</span>&nbsp;<span class="Identifier">$writer</span><br &#47;> <span class="Statement">convertto-ipad</span>&nbsp;(find <span class="Identifier">$items</span>&nbsp;<span class="String">'Comment'</span>) <span class="String">'Comment'</span>&nbsp;<span class="Identifier">$writer</span><br &#47;> <span class="Statement">convertto-ipad</span>&nbsp;(find <span class="Identifier">$items</span>&nbsp;<span class="String">'String'</span>) <span class="String">'String'</span>&nbsp;<span class="Identifier">$writer</span><br &#47;> <span class="Statement">convertto-ipad</span>&nbsp;(find <span class="Identifier">$items</span>&nbsp;<span class="String">'XML Delimiter'</span>) <span class="String">'Delimiter'</span>&nbsp;<span class="Identifier">$writer</span><br &#47;> <span class="Statement">convertto-ipad</span>&nbsp;(find <span class="Identifier">$items</span>&nbsp;<span class="String">'User Types'</span>) <span class="String">'Type'</span>&nbsp;<span class="Identifier">$writer</span><br &#47;> <span class="Statement">convertto-ipad</span>&nbsp;(find <span class="Identifier">$items</span>&nbsp;<span class="String">'Operator'</span>) <span class="String">'Operator'</span>&nbsp;<span class="Identifier">$writer</span><br &#47;> <span class="Statement">convertto-ipad</span>&nbsp;(find <span class="Identifier">$items</span>&nbsp;<span class="String">'XSLT Keyword'</span>) <span class="String">'Hyperlink'</span>&nbsp;<span class="Identifier">$writer</span><br &#47;> <span class="Statement">convertto-ipad</span>&nbsp;(find <span class="Identifier">$items</span>&nbsp;<span class="String">'Line Numbers'</span>) <span class="String">'line number'</span>&nbsp;<span class="Identifier">$writer</span><br &#47;> <span class="Identifier">$writer</span>.WriteEndElement()<br &#47;> <span class="Identifier">$writer</span>.Close() </code></div>
<p>To run the script, just pass in the path to your vssettings file and the directory where the ClassificationFormats.xcml file should be generated. There&rsquo;s also an optional boolean parameter specifying whether to leave bolds as bolds or translate them to italics instead.</p>
<p><b>Update:</b> I just fixed a bug in the script: I forgot that the vssettings format represents colors in BGR instead of RGB format, so the colors were coming out wrong sometimes.</p><!--end_raw--></p>
