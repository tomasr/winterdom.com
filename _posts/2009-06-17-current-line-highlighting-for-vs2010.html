---
layout: post
status: publish
published: true
title: Current Line Highlighting for VS2010
author:
  display_name: Tomas Restrepo
  login: tomasr
  email: tomas@winterdom.com
  url: http://winterdom.com/
author_login: tomasr
author_email: tomas@winterdom.com
author_url: http://winterdom.com/
wordpress_id: 1279
wordpress_url: http://winterdom.com/2009/06/current-line-highlighting-for-vs2010
date: '2009-06-17 02:17:22 +0000'
date_gmt: '2009-06-17 02:17:22 +0000'
categories:
- Visual Studio
tags: []
comments:
- id: 904
  author: Damien Guard
  author_email: damien@envytech.co.uk
  author_url: http://damieng.com
  date: '2009-06-17 04:31:20 +0000'
  date_gmt: '2009-06-17 04:31:20 +0000'
  content: "But why is Envy Code R appearing in fake-italic (oblique)...\r\n\r\n[)amien"
- id: 907
  author: Tomas Restrepo
  author_email: tomas@winterdom.com
  author_url: http://winterdom.com/
  date: '2009-06-17 12:26:17 +0000'
  date_gmt: '2009-06-17 12:26:17 +0000'
  content: Because until the editor options actually support enabling italics, I'm
    still using Envy Code R VS :) Too lazy to figure out a way to work around it for
    now.
- id: 1048
  author: Rene
  author_email: rk@carexstudios.de
  author_url: ''
  date: '2009-07-23 15:44:04 +0000'
  date_gmt: '2009-07-23 15:44:04 +0000'
  content: "Hi Tomas\r\n\r\nwhat's the Name of this Theme. \r\n\r\nvery very nice.\r\nRene"
- id: 1051
  author: Tomas Restrepo
  author_email: tomas@winterdom.com
  author_url: http://winterdom.com/
  date: '2009-07-23 19:18:22 +0000'
  date_gmt: '2009-07-23 19:18:22 +0000'
  content: "@Rene: It's not yet a full theme, really. It's just something I've been
    using lately which is a modified version of my Distant Shores theme, but it's
    very rough. Might try to finish it up one of these days and post it :)"
- id: 1053
  author: Rene
  author_email: rk@carexstudios.de
  author_url: ''
  date: '2009-07-24 09:00:31 +0000'
  date_gmt: '2009-07-24 09:00:31 +0000'
  content: "Great News!\r\n\r\nDistant Shores is my favorite theme at the moment.
    \r\n\r\nthank you"
- id: 1065
  author: Patrick Szalapski
  author_email: szal0003@umn.edu
  author_url: http://ShareYourFaith.org
  date: '2009-07-31 13:22:13 +0000'
  date_gmt: '2009-07-31 13:22:13 +0000'
  content: Could this be adapted for VS2008?
- id: 1066
  author: Tomas Restrepo
  author_email: tomas@winterdom.com
  author_url: http://winterdom.com/
  date: '2009-07-31 17:15:10 +0000'
  date_gmt: '2009-07-31 17:15:10 +0000'
  content: "@Patrick: Not really... this uses the completely new extensibility model
    and editor features in VS2010. I know there are other plugins for VS2008 that
    support this feature, though (like resharper)."
- id: 1073
  author: Zuhaib
  author_email: zuhaib@zuhaib.in
  author_url: http://www.zuhaib.in/
  date: '2009-08-06 07:16:05 +0000'
  date_gmt: '2009-08-06 07:16:05 +0000'
  content: "Gr8 Job .. Please finish the theme soon .. would love to have this theme
    on VS 2008 &amp; VS 2010\r\n\r\nThanks"
- id: 1167
  author: Yang
  author_email: onsy@163.com
  author_url: ''
  date: '2009-10-20 01:26:51 +0000'
  date_gmt: '2009-10-20 01:26:51 +0000'
  content: "Cool,i love this theme very much!\r\nBTW：What is this font？"
- id: 1168
  author: Tomas Restrepo
  author_email: tomas@winterdom.com
  author_url: http://winterdom.com/
  date: '2009-10-20 18:15:20 +0000'
  date_gmt: '2009-10-20 18:15:20 +0000'
  content: 'The font is Damien Guard''s Envy Code R: http:&#47;&#47;damieng.com&#47;blog&#47;2008&#47;05&#47;26&#47;envy-code-r-preview-7-coding-font-released'
- id: 1474
  author: Lance
  author_email: lancecontreras@gmail.com
  author_url: ''
  date: '2010-05-05 09:10:03 +0000'
  date_gmt: '2010-05-05 09:10:03 +0000'
  content: How can you change the hilight color?
- id: 1475
  author: Tomas Restrepo
  author_email: tomas@winterdom.com
  author_url: http://winterdom.com/
  date: '2010-05-05 13:03:32 +0000'
  date_gmt: '2010-05-05 13:03:32 +0000'
  content: "@Lance: You can do so from the Fonts & Color section in the Tools -> Options
    dialog. Look for the Current Line entry."
- id: 3860
  author: Arsen
  author_email: mkrtchyan.arsen@gmail.com
  author_url: ''
  date: '2012-11-13 22:15:28 +0000'
  date_gmt: '2012-11-13 22:15:28 +0000'
  content: "Hi, \r\nGreat post, vs sdk has really poor documentation, thanks a lot
    for bloing about extenisions\r\n\r\nCan I somehow use IClassificationFormatMap
    to refresh ITextParagraphPropertiesFactoryService? I found the same question I
    need here(http:&#47;&#47;stackoverflow.com&#47;questions&#47;13249249&#47;how-can-i-force-an-iwpftextview-to-refresh-invalidate-its-layout)
    anunswered, I'll really appreciate if you can take a look\r\n\r\nThanks in advance"
---
<p>I&rsquo;ve created another simple extension for Visual Studio 2010 beta 1 that will highlight the current line the caret is in with a different background color. Here&rsquo;s a screenshot of the extension in action:</p>
<p><a href="http:&#47;&#47;winterdom.com&#47;wp-content&#47;uploads&#47;2009&#47;06&#47;vs10_clh_1.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="vs10_clh_1" border="0" alt="vs10_clh_1" src="http:&#47;&#47;winterdom.com&#47;wp-content&#47;uploads&#47;2009&#47;06&#47;vs10_clh_1_thumb.png" width="640" height="374" &#47;></a> </p>
<p>The extension itself is pretty simple, but it was a good way to understand how adornments for the text editor worked. I think it&rsquo;s a fairly elegant mechanism that offers quite a bit of potential. A couple of things that I liked quite a bit about it:</p>
<ol>
<li>You can easily configure the order in which your adornment layer is rendered in, compared to the rest of the stuff in the editor. For example, you might want to render it last of all, or perhaps after the text, but before the selection mask. Like other editor extensions, the [Order] attribute on your <code>AdornmentLayerDefinition</code> controls this. </li>
<li>You can ask VS to position your adornment relative to the span of text it is associated with, or to the view layout, and VS will do most of the hard work of keeping it in the right place as the buffer view is scrolled and moved. It makes some things a lot easier. </li> </ol>
<p>The other thing I found interesting about creating the sample was how you could leverage the Classifications system to integrate with the Fonts and Colors configuration options for an extension that is not a custom classifier extension.</p>
<p>If you look at the extension code, you&rsquo;ll notice that I have a custom <code>ClassificationFormatDefinition</code> named &ldquo;Current Line&rdquo;, which allows the user to easily change the colors used to render the current line adornment. Then, in the code, I can get the settings the user configured (or the default ones provided by the classification format) by using the <code>IClassificationFormatMapService</code>. </p>
<p>This service gives you an <code>IClassificationFormatMap</code> that provides two key things: </p>
<ul>
<li>Get the <code>TextFormattingRunProperties</code> that contains the brushes and other settings you need to use for drawing your adornment, and </li>
<li>An event you can attach to in order to get notified when the user changes the fonts&#47;color settings so that you can refresh your customization. </li> </ul>
<p>Pretty cool stuff. You can grab the <a href="http:&#47;&#47;github.com&#47;tomasr&#47;LineAdornments&#47;tree&#47;master">code for the extension</a> from the GitHub repository.</p></p>
