---
layout: post
status: publish
published: true
title: Custom WCF Behaviors Through App.Config
author:
  display_name: Tomas Restrepo
  login: tomasr
  email: tomas@winterdom.com
  url: http://winterdom.com/
author_login: tomasr
author_email: tomas@winterdom.com
author_url: http://winterdom.com/
wordpress_id: 769
wordpress_url: http://winterdom.com/2006/10/customwcfbehaviorsthroughappconfig
date: '2006-10-02 14:55:49 +0000'
date_gmt: '2006-10-02 14:55:49 +0000'
categories:
- WCF
- WinFX
- Web Services
tags: []
comments:
- id: 520
  author: Ross Holder
  author_email: ross.holder@gmail.com
  author_url: http://ross613.spaces.live.com
  date: '2007-06-08 14:59:45 +0000'
  date_gmt: '2007-06-08 14:59:45 +0000'
  content: |
    I've been playing around with this stuff at work a fair bit lately, and am intrigued.  However, for what I've in mind to do with behaviors - I'll need to have the ability to register a single stackElement with multiple <behavior ...&#47;> tags.  Is this possible?  If not what other approaches can one undertake to achieve the desired effect?
    (BTW - have tried creating additional stackElement instances of the same type and inserting them wtihin multiple endpoint behaviors and was told by SvcConfig that this isn't allowed.)
    Gratefully,
    RH
- id: 1074
  author: 'WCF Security: WCF Performance &amp; ProtectionLevel &#8211; Part 2 &laquo;
    Adil Akhter&#39;s Weblog'
  author_email: ''
  author_url: http://adilakhter.wordpress.com/2009/08/06/wcf-security-wcf-performance-protectionlevel-part-2/
  date: '2009-08-07 12:48:12 +0000'
  date_gmt: '2009-08-07 12:48:12 +0000'
  content: "[...] Custom WCF Behaviors through App.Config :http:&#47;&#47;winterdom.com&#47;2006&#47;10&#47;customwcfbehaviorsthroughappconfig
    [...]"
- id: 1602
  author: Suresh
  author_email: suresh.thotakura@gmail.com
  author_url: ''
  date: '2010-10-29 12:00:25 +0000'
  date_gmt: '2010-10-29 12:00:25 +0000'
  content: excellent article!!
- id: 1918
  author: Nadav Yeheskel
  author_email: nadavy@any-techs.co.il
  author_url: http://www.any-techs.co.il
  date: '2012-02-06 18:23:01 +0000'
  date_gmt: '2012-02-06 18:23:01 +0000'
  content: "If you are having trouble with your service and you are getting the following
    error:\r\n\"An error occurred creating the configuration section handler for system.serviceModel&#47;behaviors:
    'XXXXXXXX' Extension element  cannot be added to this element.  Verify that the
    extension is registered in the extension collection at system.serviceModel&#47;extensions&#47;behaviorExtensions.\"\r\n\r\nLook
    at this link:\r\nhttp:&#47;&#47;connect.microsoft.com&#47;wcf&#47;feedback&#47;details&#47;216431&#47;wcf-fails-to-find-custom-behaviorextensionelement-if-type-attribute-doesnt-match-exactly"
---
<p><!--start_raw-->
<p>You can create extension elements in your WCF configuration files in order to support introducing custom behaviors (such as IEndpointBehavior-implementations) into the processing pipeline in a declarative manner. However, the <a href="http:&#47;&#47;windowssdk.msdn.microsoft.com&#47;en-us&#47;library&#47;ms730137.aspx">documentation online</a> at this moment isn't too clear on the issue (well, it's outdated, so of course it's not clear!).</p></p>
<p>Doing it fortunately is not hard; here's how to:</p></p>
<p>1. Create your custom behavior configuration element by creating a class that derives from the System.ServiceModel.Configuration.BehaviorExtensionElement class.</p></p>
<p>2. Add any properties you need to the class to represent attributes in the configuration element, and mark them with the [ConfigurationElement] attribute. For example:</p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; background: white none repeat scroll 0% 50%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; line-height: normal;"><span style="font-size: 10pt; color: gray; font-family: 'Courier New';">&#47;&#47;&#47;</span><span style="font-size: 10pt; color: green; font-family: 'Courier New';"> </span><span style="font-size: 10pt; color: gray; font-family: 'Courier New';"><br />
<summary></span><span style="font-size: 10pt; color: green; font-family: 'Courier New';"><o:p></o:p></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; background: white none repeat scroll 0% 50%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; line-height: normal;"><span style="font-size: 10pt; color: gray; font-family: 'Courier New';">&#47;&#47;&#47;</span><span style="font-size: 10pt; color: green; font-family: 'Courier New';"> Notice to add to the service<o:p></o:p></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; background: white none repeat scroll 0% 50%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; line-height: normal;"><span style="font-size: 10pt; color: gray; font-family: 'Courier New';">&#47;&#47;&#47;</span><span style="font-size: 10pt; color: green; font-family: 'Courier New';"> WSDL and XSD<o:p></o:p></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; background: white none repeat scroll 0% 50%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; line-height: normal;"><span style="font-size: 10pt; color: gray; font-family: 'Courier New';">&#47;&#47;&#47;</span><span style="font-size: 10pt; color: green; font-family: 'Courier New';"> </span><span style="font-size: 10pt; color: gray; font-family: 'Courier New';"></summary><o:p></o:p></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; background: white none repeat scroll 0% 50%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; line-height: normal;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';">[ConfigurationProperty("notice", DefaultValue="", IsRequired=</span><span style="font-size: 10pt; color: blue; font-family: 'Courier New';">true</span><span style="font-size: 10pt; color: black; font-family: 'Courier New';">)]<o:p></o:p></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; background: white none repeat scroll 0% 50%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; line-height: normal;"><span style="font-size: 10pt; color: blue; font-family: 'Courier New';">public</span><span style="font-size: 10pt; color: black; font-family: 'Courier New';"> </span><span style="font-size: 10pt; color: blue; font-family: 'Courier New';">string</span><span style="font-size: 10pt; color: black; font-family: 'Courier New';"> Notice<o:p></o:p></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; background: white none repeat scroll 0% 50%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; line-height: normal;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';">{<o:p></o:p></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; background: white none repeat scroll 0% 50%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; line-height: normal;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';"><span style="">&nbsp;&nbsp; </span></span><span style="font-size: 10pt; color: blue; font-family: 'Courier New';">get</span><span style="font-size: 10pt; color: black; font-family: 'Courier New';"> { </span><span style="font-size: 10pt; color: blue; font-family: 'Courier New';">return</span><span style="font-size: 10pt; color: black; font-family: 'Courier New';"> (</span><span style="font-size: 10pt; color: blue; font-family: 'Courier New';">string</span><span style="font-size: 10pt; color: black; font-family: 'Courier New';">)</span><span style="font-size: 10pt; color: blue; font-family: 'Courier New';">base</span><span style="font-size: 10pt; color: black; font-family: 'Courier New';">["notice"]; }<o:p></o:p></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; background: white none repeat scroll 0% 50%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; line-height: normal;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';"><span style="">&nbsp;&nbsp; </span></span><span style="font-size: 10pt; color: blue; font-family: 'Courier New';">set</span><span style="font-size: 10pt; color: black; font-family: 'Courier New';"> { </span><span style="font-size: 10pt; color: blue; font-family: 'Courier New';">base</span><span style="font-size: 10pt; color: black; font-family: 'Courier New';">["notice"] = value; }<o:p></o:p></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; background: white none repeat scroll 0% 50%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; line-height: normal;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';">}</span><span style="font-size: 10pt; font-family: 'Courier New';"><o:p></o:p></span></p></p>
<p>
</p>
<p>3. Override the BehaviorType property and return the type of the behavior your configuration element will introduce into the pipeline:</p>
<pre style="background: white none repeat scroll 0% 50%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;"><span style="color: gray;">&#47;&#47;&#47;</span><span style="color: green;"> </span><span style="color: gray;"><br />
<summary><br>&#47;&#47;&#47;</span><span style="color: gray;"> <font color="#008000">Return the type of the behavior we configure</font><br><font color="#808080">&#47;&#47;&#47;</font></span><font color="#808080"><span style="color: green;"> </span></font><span style="color: blue;"><font color="#808080"></summary></font><o:p></o:p><br>public</span><span style="color: black;"> </span><span style="color: blue;">override</span><span style="color: black;"> Type <span class="SpellE">BehaviorType</span><o:p></o:p><br>{<o:p></o:p><span style=""><br>&nbsp;&nbsp; </span></span><span style="color: blue;">get</span><span style="color: black;"> { </span><span style="color: blue;">return</span><span style="color: black;"> </span><span class="SpellE"><span style="color: blue;">typeof</span></span><span style="color: black;">(<span class="SpellE">WsdlNoticeBehavior</span>); }<o:p></o:p><br>}</span></pre>
<p></p></p>
<p>4. Override the CreateBehavior() method; this is where you create and return an instance of your custom behavior based on the properties you hold from the configuration element:</p>
<pre style="background: white none repeat scroll 0% 50%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;"><span style="color: gray;">&#47;&#47;&#47;</span><span style="color: green;"> </span><span style="color: gray;"><br />
<summary><br></span><span style="color: gray;">&#47;&#47;&#47;</span><span style="color: green;"> Create an instance of the behavior<br></span><span style="color: gray;">&#47;&#47;&#47;</span><span style="color: green;"> we represent<br></span><span style="color: gray;">&#47;&#47;&#47;</span><span style="color: green;"> </span><span style="color: gray;"></summary><br></span><span style="color: gray;">&#47;&#47;&#47;</span><span style="color: green;"> </span><span style="color: gray;"><returns></span><span style="color: green;">The WsdlNoticeBehavior instance</span><span style="color: gray;"></returns><br></span><span style="color: blue;">protected</span><span style="color: black;"> </span><span style="color: blue;">override</span><span style="color: black;"> </span><span style="color: blue;">object</span><span style="color: black;"> CreateBehavior()<br></span><span style="color: black;">{<br></span><span style="color: black;"><span style="">&nbsp;&nbsp; </span></span><span style="color: blue;">return</span><span style="color: black;"> </span><span style="color: blue;">new</span><span style="color: black;"> WsdlNoticeBehavior(Notice);<br></span><span style="color: black;">}<o:p></o:p></span></pre></p>
<p>5. You'll likely want to override the Properties property and the CopyFrom() method as well:</p>
<pre style="background: white none repeat scroll 0% 50%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;"><span style="color: blue;">private</span><span style="color: black;"> ConfigurationPropertyCollection _properties;</span><span style="color: black;"><o:p>&nbsp;</o:p></span></pre>
<pre style="background: white none repeat scroll 0% 50%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;"><span style="color: gray;">&#47;&#47;&#47;</span><span style="color: green;"> </span><span style="color: gray;"><br />
<summary><br></span><span style="color: gray;">&#47;&#47;&#47;</span><span style="color: green;"> Return a collection of all our properties<br></span><span style="color: gray;">&#47;&#47;&#47;</span><span style="color: green;"> </span><span style="color: gray;"></summary><br></span><span style="color: blue;">protected</span><span style="color: black;"> </span><span style="color: blue;">override</span><span style="color: black;"> ConfigurationPropertyCollection Properties<o:p></o:p><br>{<o:p></o:p><span style=""><br>&nbsp;&nbsp; </span></span><span style="color: blue;">get</span><span style="color: black;"><o:p></o:p><span style=""><br>&nbsp;&nbsp; </span>{<o:p></o:p><span style=""><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: blue;">if</span><span style="color: black;"> ( _properties == </span><span style="color: blue;">null</span><span style="color: black;"> )<o:p></o:p><span style=""><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{<o:p></o:p><span style=""><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>_properties = </span><span style="color: blue;">new</span><span style="color: black;"> ConfigurationPropertyCollection();<o:p></o:p><span style=""><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>_properties.Add(</span><span style="color: blue;">new</span><span style="color: black;"> ConfigurationProperty(<o:p></o:p><span style=""><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>"notice", </span><span style="color: blue;">typeof</span><span style="color: black;">(</span><span style="color: blue;">string</span><span style="color: black;">), "",<o:p></o:p><span style=""><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>ConfigurationPropertyOptions.IsRequired<o:p></o:p><span style=""><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>));<o:p></o:p><span style=""><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p><span style=""><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: blue;">return</span><span style="color: black;"> _properties;<o:p></o:p><span style=""><br>&nbsp;&nbsp; </span>}<o:p></o:p><br>}</span></pre>
<pre style="background: white none repeat scroll 0% 50%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;"><span style="color: gray;">&#47;&#47;&#47;</span><span style="color: green;"> </span><span style="color: gray;"><br />
<summary><br>&#47;&#47;&#47;</span><span style="color: gray;"> <font color="#008000">Copy the information of another element into</font><br>&#47;&#47;&#47;</span><span style="color: gray;"> <font color="#008000">ourselves</font><br>&#47;&#47;&#47;</span><span style="color: green;"> </span><span style="color: gray;"></summary></span><span style="color: gray;"><o:p></o:p><br>&#47;&#47;&#47;</span><span style="color: green;"> </span><span style="color: gray;">
<param name="from"></span><span style="color: green;">The element from which to copy</span><span style="color: blue;"><font color="#808080"></param></font><o:p></o:p><br>public</span><span style="color: black;"> </span><span style="color: blue;">override</span><span style="color: black;"> </span><span style="color: blue;">void</span><span style="color: black;"> CopyFrom(ServiceModelExtensionElement from)<o:p></o:p><br>{<o:p></o:p><span style=""><br>&nbsp;&nbsp; </span></span><span style="color: blue;">base</span><span style="color: black;">.CopyFrom(from);<o:p></o:p><span style=""><br>&nbsp;&nbsp; </span>WsdlNoticeElement element = (WsdlNoticeElement)from;<o:p></o:p><span style=""><br>&nbsp;&nbsp; </span>Notice = element.Notice;<o:p></o:p><br>}</span></pre></p>
<p>After this, you're ready to introduce your behavior into the configuration file. First, you need to register your custom behavior configuration element by adding it in the <system.servicemodel>&#47;<extensions>&#47;<behaviorExtensions> element:</p>
<pre style="background: white none repeat scroll 0% 50%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;"><span style="color: blue;"><</span><span style="color: maroon;">extensions</span><span style="color: black;">><br><span style="">&nbsp;&nbsp; </span></span><span style="color: blue;"><</span><span style="color: maroon;">behaviorExtensions</span><span style="color: blue;">></span><span style="color: black;"><o:p></o:p><span style=""><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: blue;"><</span><span style="color: maroon;">add </span><span style="color: red;">name</span><span style="color: blue;">="wsdlNotice"</span><span style="color: red;"> <o:p></o:p><span style=""><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=""> </span>type</span><span style="color: blue;">="Winterdom.ServiceModel.Extensions.Configuration.WsdlNoticeElement, <br>Winterdom.ServiceModel.Extensions, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"</span><span style="color: red;"><o:p></o:p><span style=""><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: blue;">&#47;></span><span style="color: black;"><o:p></o:p><span style=""><br>&nbsp;&nbsp; </span></span><span style="color: blue;"></</span><span style="color: maroon;">behaviorExtensions</span><span style="color: blue;">></span><span style="color: blue;"><o:p></o:p><br></</span><span style="color: maroon;">extensions</span><span style="color: blue;">></span></pre></p>
<p>Now you can use your custom element in the correct behaviors collection:<br></p>
<pre style="background: white none repeat scroll 0% 50%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;"><span style="color: blue;"><</span><span style="color: maroon;">behaviors</span><span style="color: blue;">></span><span style="color: black;"><o:p></o:p><span style=""><br>&nbsp;&nbsp; </span></span><span style="color: blue;"><</span><span style="color: maroon;">endpointBehaviors</span><span style="color: blue;">></span><span style="color: black;"><o:p></o:p><span style=""><br>&nbsp;&nbsp;&nbsp; </span><span style="">&nbsp; </span></span><span style="color: blue;"><</span><span style="color: maroon;">behavior </span><span style="color: red;">name</span><span style="color: blue;">="EndpointBehaviors"></span><span style="color: black;"><o:p></o:p><span style=""><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: blue;"><</span><span style="color: maroon;">wsdlNotice </span><span style="color: red;">notice</span><span style="color: blue;">="This is a notice"&#47;></span><span style="color: black;"><o:p></o:p><span style=""><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: blue;"></</span><span style="color: maroon;">behavior</span><span style="color: blue;">></span><span style="color: black;"><o:p></o:p><span style=""><br>&nbsp;&nbsp; </span></span><span style="color: blue;"></</span><span style="color: maroon;">endpointBehaviors</span><span style="color: blue;">></span><span style="color: blue;"><o:p></o:p><br></</span><span style="color: maroon;">behaviors</span><span style="color: blue;">></span></pre></p>
<p>That's it!</p></p>
<div class="wlWriterSmartContent" id="d7bf807d-7bb0-458a-811f-90c51817d5c2:585bb3f9-36da-4a2f-910a-47484304844d" contenteditable="false" style="margin: 0px; padding: 0px; display: inline;">
<p><span class="TagSite">Technorati:</span> <a class="tag" href="http:&#47;&#47;technorati.com&#47;tag&#47;WCF" rel="tag">WCF</a>, <a class="tag" href="http:&#47;&#47;technorati.com&#47;tag&#47;Windows+Communication+Foundation" rel="tag">Windows Communication Foundation</a>, <a class="tag" href="http:&#47;&#47;technorati.com&#47;tag&#47;WCF+Extensibility" rel="tag">WCF Extensibility</a><br><!-- StartInsertedTags: WCF, Windows Communication Foundation, WCF Extensibility :EndInsertedTags --></p></div><!--end_raw--></p>
