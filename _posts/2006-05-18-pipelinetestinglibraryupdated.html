---
layout: post
status: publish
published: true
title: Pipeline Testing Library Updated
author:
  display_name: Tomas Restrepo
  login: tomasr
  email: tomas@winterdom.com
  url: http://winterdom.com/
author_login: tomasr
author_email: tomas@winterdom.com
author_url: http://winterdom.com/
wordpress_id: 631
wordpress_url: http://winterdom.com/2006/05/pipelinetestinglibraryupdated
date: '2006-05-18 09:13:17 +0000'
date_gmt: '2006-05-18 09:13:17 +0000'
categories:
- BizTalk
tags: []
comments: []
---
<p><!--start_raw--><P>I've just now updated my <A href="http:&#47;&#47;www.winterdom.com&#47;weblog&#47;2006&#47;04&#47;28&#47;PipelineTestingLibraryPart2.aspx">Pipeline Testing Library</A>. In this version, I've created my own mock IPipelineContext[Ex] implementation, to support configuring some functionality not previously available:</P><br />
<OL><br />
<LI>You can now configure at the pipeline level the thumbprint for the Group Signing Certificate so that it is returned from IPipelineContext.GroupSigningCertificate to pipeline components. Here's how you'd configure it:<BR><BR><br />
<P class=MsoNormal style="MARGIN: 0in 0in 0pt; LINE-HEIGHT: normal; mso-pagination: none; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 10pt; COLOR: teal; FONT-FAMILY: Consolas; mso-bidi-font-family: Consolas">SendPipelineWrapper</SPAN><SPAN style="FONT-SIZE: 10pt; FONT-FAMILY: Consolas; mso-bidi-font-family: Consolas"><FONT color=#373737> pipeline </FONT><SPAN style="COLOR: blue">=</SPAN><FONT color=#373737> </FONT><SPAN style="COLOR: teal">PipelineFactory</SPAN><SPAN style="COLOR: blue">.</SPAN><FONT color=#373737>CreateEmptySendPipeline();<?xml:namespace prefix = o ns = "urn:schemas-microsoft-com:office:office" &#47;><o:p></o:p></FONT></SPAN></P><br />
<P class=MsoNormal style="MARGIN: 0in 0in 0pt; LINE-HEIGHT: normal; mso-pagination: none; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 10pt; FONT-FAMILY: Consolas; mso-bidi-font-family: Consolas"><FONT color=#373737>pipeline</FONT><SPAN style="COLOR: blue">.</SPAN><FONT color=#373737>GroupSigningCertificate </FONT><SPAN style="COLOR: blue">=</SPAN><FONT color=#373737> </FONT><SPAN style="COLOR: maroon">"...."</SPAN><FONT color=#373737>;<BR><o:p></o:p></FONT></SPAN></P><br />
<LI>Now transactional support is available for pipeline components if you enable it (it's disabled by default). If you do enable it, then components will get a valid DTC transaction returned from IPipelineContextEx.GetTransaction(). I'm not 100% comfortable with this, but it can be useful in a few scenarios (see below for one such one). To enable it, call the EnableTransactions() method on the pipeline wrapper object just before calling Execute().</LI></OL><br />
<P>The reason why I implemented the transactional support in the pipeline context mock object is that some components require it. In particular, it turns out that the BizTalk Framework Disassembler Component (BtfDasmComp) will not work unless the pipeline context returns a valid transaction from IPipelineContextEx.GetTransaction().&nbsp; With this update, you can now test pipelines that use the BtfDasmComp component, though be aware that the transaction object is then used to access some of the biztalk databases (I'm not exactly sure yet what for, though). Here's an example piece of code with such a trick:</P><br />
<P class=MsoNormal style="MARGIN: 0in 0in 0pt; LINE-HEIGHT: normal; mso-pagination: none; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 10pt; COLOR: teal; FONT-FAMILY: Consolas; mso-bidi-font-family: Consolas">ReceivePipelineWrapper</SPAN><SPAN style="FONT-SIZE: 10pt; FONT-FAMILY: Consolas; mso-bidi-font-family: Consolas"><FONT color=#373737> pipeline </FONT><SPAN style="COLOR: blue">=</SPAN><FONT color=#373737> </FONT><SPAN style="COLOR: teal">PipelineFactory</SPAN><SPAN style="COLOR: blue">.</SPAN><FONT color=#373737>CreateEmptyReceivePipeline();<o:p></o:p></FONT></SPAN></P><br />
<P class=MsoNormal style="MARGIN: 0in 0in 0pt; LINE-HEIGHT: normal; mso-pagination: none; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 10pt; FONT-FAMILY: Consolas; mso-bidi-font-family: Consolas"><FONT color=#373737>pipeline</FONT><SPAN style="COLOR: blue">.</SPAN><FONT color=#373737>AddComponent(</FONT><SPAN style="COLOR: blue">new</SPAN><FONT color=#373737> </FONT><SPAN style="COLOR: teal">BtfDasmComp</SPAN><FONT color=#373737>(), </FONT><SPAN style="COLOR: teal">PipelineStage</SPAN><SPAN style="COLOR: blue">.</SPAN><FONT color=#373737>Disassemble);<o:p></o:p></FONT></SPAN></P><br />
<P class=MsoNormal style="MARGIN: 0in 0in 0pt; LINE-HEIGHT: normal; mso-pagination: none; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 10pt; COLOR: teal; FONT-FAMILY: Consolas; mso-bidi-font-family: Consolas">FixEncodingComponent</SPAN><SPAN style="FONT-SIZE: 10pt; FONT-FAMILY: Consolas; mso-bidi-font-family: Consolas"><FONT color=#373737> fix </FONT><SPAN style="COLOR: blue">=</SPAN><FONT color=#373737> </FONT><SPAN style="COLOR: blue">new</SPAN><FONT color=#373737> </FONT><SPAN style="COLOR: teal">FixEncodingComponent</SPAN><FONT color=#373737>();<o:p></o:p></FONT></SPAN></P><br />
<P class=MsoNormal style="MARGIN: 0in 0in 0pt; LINE-HEIGHT: normal; mso-pagination: none; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 10pt; FONT-FAMILY: Consolas; mso-bidi-font-family: Consolas"><FONT color=#373737>fix</FONT><SPAN style="COLOR: blue">.</SPAN><FONT color=#373737>Encoding </FONT><SPAN style="COLOR: blue">=</SPAN><FONT color=#373737> </FONT><SPAN style="COLOR: teal">Encoding</SPAN><SPAN style="COLOR: blue">.</SPAN><FONT color=#373737>Unicode;<o:p></o:p></FONT></SPAN></P><br />
<P class=MsoNormal style="MARGIN: 0in 0in 0pt; LINE-HEIGHT: normal; mso-pagination: none; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 10pt; FONT-FAMILY: Consolas; mso-bidi-font-family: Consolas"><FONT color=#373737>pipeline</FONT><SPAN style="COLOR: blue">.</SPAN><FONT color=#373737>AddComponent(fix, </FONT><SPAN style="COLOR: teal">PipelineStage</SPAN><SPAN style="COLOR: blue">.</SPAN><FONT color=#373737>Decode);<o:p></o:p></FONT></SPAN></P><br />
<P class=MsoNormal style="MARGIN: 0in 0in 0pt; LINE-HEIGHT: normal; mso-pagination: none; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 10pt; FONT-FAMILY: Consolas; mso-bidi-font-family: Consolas"><o:p><FONT color=#373737>&nbsp;</FONT></o:p></SPAN></P><br />
<P class=MsoNormal style="MARGIN: 0in 0in 0pt; LINE-HEIGHT: normal; mso-pagination: none; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 10pt; FONT-FAMILY: Consolas; mso-bidi-font-family: Consolas"><FONT color=#373737>pipeline</FONT><SPAN style="COLOR: blue">.</SPAN><FONT color=#373737>EnableTransactions();<o:p></o:p></FONT></SPAN></P><br />
<P class=MsoNormal style="MARGIN: 0in 0in 0pt; LINE-HEIGHT: normal; mso-pagination: none; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 10pt; FONT-FAMILY: Consolas; mso-bidi-font-family: Consolas"><o:p><FONT color=#373737>&nbsp;</FONT></o:p></SPAN></P><br />
<P class=MsoNormal style="MARGIN: 0in 0in 0pt; LINE-HEIGHT: normal; mso-pagination: none; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 10pt; COLOR: teal; FONT-FAMILY: Consolas; mso-bidi-font-family: Consolas">Stream</SPAN><SPAN style="FONT-SIZE: 10pt; FONT-FAMILY: Consolas; mso-bidi-font-family: Consolas"><FONT color=#373737> input </FONT><SPAN style="COLOR: blue">=</SPAN><FONT color=#373737> </FONT><SPAN style="COLOR: blue">new</SPAN><FONT color=#373737> </FONT><SPAN style="COLOR: teal">FileStream</SPAN><FONT color=#373737>(</FONT><SPAN style="COLOR: maroon">@"e:\temp\BtfDasmTest\BOBUILDING_SITE2.xml"</SPAN><FONT color=#373737>, </FONT><SPAN style="COLOR: teal">FileMode</SPAN><SPAN style="COLOR: blue">.</SPAN><FONT color=#373737>Open);<o:p></o:p></FONT></SPAN></P><br />
<P class=MsoNormal style="MARGIN: 0in 0in 0pt; LINE-HEIGHT: normal; mso-pagination: none; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 10pt; COLOR: teal; FONT-FAMILY: Consolas; mso-bidi-font-family: Consolas">IBaseMessage</SPAN><SPAN style="FONT-SIZE: 10pt; FONT-FAMILY: Consolas; mso-bidi-font-family: Consolas"><FONT color=#373737> inputMsg </FONT><SPAN style="COLOR: blue">=</SPAN><FONT color=#373737> </FONT><SPAN style="COLOR: teal">MessageHelper</SPAN><SPAN style="COLOR: blue">.</SPAN><FONT color=#373737>CreateFromStream(input);<o:p></o:p></FONT></SPAN></P><br />
<P class=MsoNormal style="MARGIN: 0in 0in 0pt; LINE-HEIGHT: normal; mso-pagination: none; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 10pt; FONT-FAMILY: Consolas; mso-bidi-font-family: Consolas"><o:p><FONT color=#373737>&nbsp;</FONT></o:p></SPAN></P><br />
<P class=MsoNormal style="MARGIN: 0in 0in 0pt; LINE-HEIGHT: normal; mso-pagination: none; mso-layout-grid-align: none; mso-outline-level: 1"><SPAN style="FONT-SIZE: 10pt; COLOR: teal; FONT-FAMILY: Consolas; mso-bidi-font-family: Consolas">MessageCollection</SPAN><SPAN style="FONT-SIZE: 10pt; FONT-FAMILY: Consolas; mso-bidi-font-family: Consolas"><FONT color=#373737> outputMsgs </FONT><SPAN style="COLOR: blue">=</SPAN><FONT color=#373737> pipeline</FONT><SPAN style="COLOR: blue">.</SPAN><FONT color=#373737>Execute(inputMsg);<o:p></o:p></FONT></SPAN></P><br />
<P>&nbsp;</P><!--end_raw--></p>
