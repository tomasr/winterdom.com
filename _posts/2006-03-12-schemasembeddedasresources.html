---
layout: post
status: publish
published: true
title: Schemas embedded as resources
author:
  display_name: Tomas Restrepo
  login: tomasr
  email: tomas@winterdom.com
  url: http://winterdom.com/
author_login: tomasr
author_email: tomas@winterdom.com
author_url: http://winterdom.com/
wordpress_id: 400
wordpress_url: http://winterdom.com/2006/03/schemasembeddedasresources
date: '2006-03-12 06:52:45 +0000'
date_gmt: '2006-03-12 06:52:45 +0000'
categories:
- ".NET"
- XML
tags: []
comments: []
---
<p><!--start_raw-->
<p><a href="http:&#47;&#47;www.hanselman.com&#47;blog">Scott</a> comments <a href="http:&#47;&#47;www.hanselman.com&#47;blog&#47;CommentView.aspx?guid=413e8258-ae5b-4949-9cee-43c112c0d3b2">here</a> on a utility XmlUrlResolver he wrote to load schemas embedded as resources in .NET assemblies that contain includes between them. This is a powerful feature, and it's nice to see how the XML stack was open to extension in ways like this.<br><br>FWIW, I did something like this a few years back (2002, actually) to load XSLTs embedded as resources for the original <a href="&#47;dev&#47;dotnet&#47;Nant&#47;BuildTasks.html">NUnitReport</a> task for <a href="http:&#47;&#47;nant.sourceforge.net&#47;">NAnt</a>. Here's the code I wrote back then, which is pretty similar to Scott's code (except that I used an explicit URI schema):<br><br><br></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: gray; font-family: Consolas;">&#47;&#47;&#47;</span><span style="font-size: 10pt; color: green; font-family: Consolas;"> </span><span style="font-size: 10pt; color: gray; font-family: Consolas;"><br />
<summary><o:p></o:p></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: gray; font-family: Consolas;">&#47;&#47;&#47;</span><span style="font-size: 10pt; color: green; font-family: Consolas;"> Loads the XSLT Transform<o:p></o:p></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: gray; font-family: Consolas;">&#47;&#47;&#47;</span><span style="font-size: 10pt; color: green; font-family: Consolas;"> </span><span style="font-size: 10pt; color: gray; font-family: Consolas;"></summary><o:p></o:p></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: gray; font-family: Consolas;">&#47;&#47;&#47;</span><span style="font-size: 10pt; color: green; font-family: Consolas;"> </span><span style="font-size: 10pt; color: gray; font-family: Consolas;"><remarks><o:p></o:p></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: gray; font-family: Consolas;">&#47;&#47;&#47;</span><span style="font-size: 10pt; color: green; font-family: Consolas;"> This method will load the file specified<o:p></o:p></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: gray; font-family: Consolas;">&#47;&#47;&#47;</span><span style="font-size: 10pt; color: green; font-family: Consolas;"> through the the xslfile attribute, or<o:p></o:p></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: gray; font-family: Consolas;">&#47;&#47;&#47;</span><span style="font-size: 10pt; color: green; font-family: Consolas;"> the default transformation included<o:p></o:p></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: gray; font-family: Consolas;">&#47;&#47;&#47;</span><span style="font-size: 10pt; color: green; font-family: Consolas;"> as a managed resource.<o:p></o:p></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: gray; font-family: Consolas;">&#47;&#47;&#47;</span><span style="font-size: 10pt; color: green; font-family: Consolas;"> </span><span style="font-size: 10pt; color: gray; font-family: Consolas;"></remarks><o:p></o:p></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: gray; font-family: Consolas;">&#47;&#47;&#47;</span><span style="font-size: 10pt; color: green; font-family: Consolas;"> </span><span style="font-size: 10pt; color: gray; font-family: Consolas;"><returns></span><span style="font-size: 10pt; color: green; font-family: Consolas;">The Transformation to use</span><span style="font-size: 10pt; color: gray; font-family: Consolas;"></returns><o:p></o:p></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: blue; font-family: Consolas;">private</span><span style="font-size: 10pt; font-family: Consolas;"><font color="#000000"> XslTransform LoadTransform()<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><font color="#000000">{<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><font color="#000000"><span style="">&nbsp;&nbsp; </span>XslTransform xslt </font><span style="color: blue;">=</span><font color="#000000"> </font><span style="color: blue;">new</span><font color="#000000"> XslTransform();<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><span style=""><font color="#000000">&nbsp;&nbsp; </font></span><span style="color: blue;">if</span><font color="#000000"> ( XslFile </font><span style="color: blue;">!=</span><font color="#000000"> </font><span style="color: blue;">null</span><font color="#000000"> )<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><font color="#000000"><span style="">&nbsp;&nbsp; </span>{<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><font color="#000000"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>xslt</font><span style="color: blue;">.</span><font color="#000000">Load(XslFile);<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><font color="#000000"><span style="">&nbsp;&nbsp; </span>} </font><span style="color: blue;">else<o:p></o:p></span></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><font color="#000000"><span style="">&nbsp;&nbsp; </span>{<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><font color="#000000"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>XmlResolver resolver </font><span style="color: blue;">=</span><font color="#000000"> </font><span style="color: blue;">new</span><font color="#000000"> LocalResXmlResolver();<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><span style=""><font color="#000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </font></span><span style="color: teal;">Stream</span><font color="#000000"> stream </font><span style="color: blue;">=<o:p></o:p></span></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><font color="#000000"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>(</font><span style="color: teal;">Stream</span><font color="#000000">)resolver</font><span style="color: blue;">.</span><font color="#000000">GetEntity(</font><span style="color: blue;">new</span><font color="#000000"> Uri(XSL_DEF_FILE), </font><span style="color: blue;">null</span><font color="#000000">, </font><span style="color: blue;">null</span><font color="#000000">);<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><font color="#000000"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>XmlTextReader reader </font><span style="color: blue;">=</span><font color="#000000"> </font><span style="color: blue;">new</span><font color="#000000"> XmlTextReader(XSL_DEF_FILE, stream);<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><font color="#000000"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>xslt</font><span style="color: blue;">.</span><font color="#000000">Load(reader, resolver);<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><font color="#000000"><span style="">&nbsp;&nbsp; </span>}<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><span style=""><font color="#000000">&nbsp;&nbsp; </font></span><span style="color: blue;">return</span><font color="#000000"> xslt;<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><font color="#000000">}<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><o:p><font color="#000000">&nbsp;</font></o:p></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><o:p><font color="#000000">&nbsp;</font></o:p></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: gray; font-family: Consolas;">&#47;&#47;&#47;</span><span style="font-size: 10pt; color: green; font-family: Consolas;"> </span><span style="font-size: 10pt; color: gray; font-family: Consolas;"><br />
<summary><o:p></o:p></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: gray; font-family: Consolas;">&#47;&#47;&#47;</span><span style="font-size: 10pt; color: green; font-family: Consolas;"> Custom XmlResolver used to load the <o:p></o:p></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: gray; font-family: Consolas;">&#47;&#47;&#47;</span><span style="font-size: 10pt; color: green; font-family: Consolas;"> XSLT files out of this assembly resources.<o:p></o:p></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: gray; font-family: Consolas;">&#47;&#47;&#47;</span><span style="font-size: 10pt; color: green; font-family: Consolas;"> </span><span style="font-size: 10pt; color: gray; font-family: Consolas;"></summary><o:p></o:p></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: blue; font-family: Consolas;">internal</span><span style="font-size: 10pt; font-family: Consolas;"><font color="#000000"> </font><span style="color: blue;">class</span><font color="#000000"> LocalResXmlResolver : XmlUrlResolver<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><font color="#000000">{<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><span style=""><font color="#000000">&nbsp;&nbsp; </font></span><span style="color: blue;">const</span><font color="#000000"> </font><span style="color: blue;">string</span><font color="#000000"> SCHEME_MRES </font><span style="color: blue;">=</span><font color="#000000"> </font><span style="color: maroon;">"mres"</span><font color="#000000">;<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><o:p><font color="#000000">&nbsp;</font></o:p></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><span style=""><font color="#000000">&nbsp;&nbsp; </font></span><span style="color: gray;">&#47;&#47;&#47;</span><span style="color: green;"> </span><span style="color: gray;"><br />
<summary><o:p></o:p></span></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><span style=""><font color="#000000">&nbsp;&nbsp; </font></span><span style="color: gray;">&#47;&#47;&#47;</span><span style="color: green;"> Loads the XSLT file<o:p></o:p></span></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><span style=""><font color="#000000">&nbsp;&nbsp; </font></span><span style="color: gray;">&#47;&#47;&#47;</span><span style="color: green;"> </span><span style="color: gray;"></summary><o:p></o:p></span></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><span style=""><font color="#000000">&nbsp;&nbsp; </font></span><span style="color: gray;">&#47;&#47;&#47;</span><span style="color: green;"> </span><span style="color: gray;">
<param name="absoluteUri"></param><o:p></o:p></span></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><span style=""><font color="#000000">&nbsp;&nbsp; </font></span><span style="color: gray;">&#47;&#47;&#47;</span><span style="color: green;"> </span><span style="color: gray;">
<param name="role"></param><o:p></o:p></span></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><span style=""><font color="#000000">&nbsp;&nbsp; </font></span><span style="color: gray;">&#47;&#47;&#47;</span><span style="color: green;"> </span><span style="color: gray;">
<param name="objToReturn"></param><o:p></o:p></span></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><span style=""><font color="#000000">&nbsp;&nbsp; </font></span><span style="color: gray;">&#47;&#47;&#47;</span><span style="color: green;"> </span><span style="color: gray;"><returns></returns><o:p></o:p></span></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><span style=""><font color="#000000">&nbsp;&nbsp; </font></span><span style="color: blue;">public</span><font color="#000000"> </font><span style="color: blue;">override</span><font color="#000000"> </font><span style="color: blue;">object</span><font color="#000000"> GetEntity(Uri absoluteUri, </font><span style="color: blue;">string</span><font color="#000000"> role, </font><span style="color: teal;">Type</span><font color="#000000"> objToReturn)<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><font color="#000000"><span style="">&nbsp;&nbsp; </span>{<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><span style=""><font color="#000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </font></span><span style="color: blue;">if</span><font color="#000000"> ( absoluteUri</font><span style="color: blue;">.</span><font color="#000000">Scheme </font><span style="color: blue;">!=</span><font color="#000000"> SCHEME_MRES )<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><font color="#000000"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><span style=""><font color="#000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </font></span><span style="color: green;">&#47;&#47; we don't know how to handle this URI scheme....<o:p></o:p></span></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><span style=""><font color="#000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </font></span><span style="color: blue;">return</span><font color="#000000"> </font><span style="color: blue;">base.</span><font color="#000000">GetEntity(absoluteUri, role, objToReturn);<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><font color="#000000"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><span style=""><font color="#000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </font></span><span style="color: teal;">Assembly</span><font color="#000000"> thisAssm </font><span style="color: blue;">=</span><font color="#000000"> </font><span style="color: teal;">Assembly</span><span style="color: blue;">.</span><font color="#000000">GetExecutingAssembly();<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><span style=""><font color="#000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </font></span><span style="color: blue;">string</span><font color="#000000"> filename </font><span style="color: blue;">=</span><font color="#000000"> absoluteUri</font><span style="color: blue;">.</span><font color="#000000">Segments[absoluteUri</font><span style="color: blue;">.</span><font color="#000000">Segments</font><span style="color: blue;">.</span><font color="#000000">Length </font><span style="color: blue;">-</span><font color="#000000"> </font><span style="color: blue;">1</span><font color="#000000">];<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><span style=""><font color="#000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </font></span><span style="color: blue;">return</span><font color="#000000"> thisAssm</font><span style="color: blue;">.</span><font color="#000000">GetManifestResourceStream(filename);<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><font color="#000000"><span style="">&nbsp;&nbsp; </span>}<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><o:p><font color="#000000">&nbsp;</font></o:p></span></p><!--end_raw--></p>
