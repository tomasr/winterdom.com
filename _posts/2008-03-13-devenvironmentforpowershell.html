---
layout: post
status: publish
published: true
title: Dev Environment for PowerShell
author:
  display_name: Tomas Restrepo
  login: tomasr
  email: tomas@winterdom.com
  url: http://winterdom.com/
author_login: tomasr
author_email: tomas@winterdom.com
author_url: http://winterdom.com/
wordpress_id: 810
wordpress_url: http://winterdom.com/2008/03/devenvironmentforpowershell
date: '2008-03-13 06:54:58 +0000'
date_gmt: '2008-03-13 06:54:58 +0000'
categories:
- ".NET"
- PowerShell
tags: []
comments:
- id: 1464
  author: Rahul Misra
  author_email: rahulmisra@gmail.com
  author_url: ''
  date: '2010-04-29 12:34:27 +0000'
  date_gmt: '2010-04-29 12:34:27 +0000'
  content: Exactly what I needed
- id: 1465
  author: Rahul Misra
  author_email: rahulmisra@gmail.com
  author_url: ''
  date: '2010-04-29 13:19:56 +0000'
  date_gmt: '2010-04-29 13:19:56 +0000'
  content: "This didn't work fully. On executing msbuild I got errors saying it did
    not recognise the .sln file format.  I know it can be tweaked to get it working,
    however using the code below worked for me.\r\n\r\nhttp:&#47;&#47;allen-mack.blogspot.com&#47;2008&#47;03&#47;replace-visual-studio-command-prompt.html"
- id: 1466
  author: Tomas Restrepo
  author_email: tomas@winterdom.com
  author_url: http://winterdom.com/
  date: '2010-04-29 15:49:14 +0000'
  date_gmt: '2010-04-29 15:49:14 +0000'
  content: "@Rahul: You're probably trying to build solutions with the wrong version.
    The script above doesn't support .net 4.0 yet."
---
<p><!--start_raw-->
<p>A few people have asked already about my PowerShell script for configuring a development environment for .NET &#47; Visual Studio &#47; SDK work, so I thought I might as well break it into it's own script.</p>
<p>Here it is:</p>
<div class="codebg"><code><span class="Comment">###############################################################################</span>      <br &#47;><span class="Comment"># Configures the .NET &#47; Visual Studio &#47; Windows SDK</span>      <br &#47;><span class="Comment"># Build environment. Loosely based on the SDK batch files.</span>      <br &#47;><span class="Comment"># </span>      <br &#47;><span class="Comment"># First it will try to set up the environment for .NET 3.5</span>      <br &#47;><span class="Comment"># and VS2008. Failing that, falls back to .NET 3.0&#47;VS2005.</span>      <br &#47;><span class="Comment">###############################################################################</span>      <br &#47;>      <br &#47;><span class="Identifier">$NETFXDIR</span> = <span class="String">"$env:WINDIR\Microsoft.NET\Framework"</span>      <br &#47;><span class="Identifier">$FX20</span> = <span class="String">"$NETFXDIR\v2.0.50727"</span>      <br &#47;><span class="Identifier">$FX35</span> = <span class="String">"$NETFXDIR\v3.5"</span>      <br &#47;>      <br &#47;><span class="Keyword">function</span>&#160;<span class="Function">script</span>:<span class="Statement">append-path</span> {       <br &#47;>&#160;&#160; <span class="Identifier">$env:PATH</span> += <span class="String">';'</span> + <span class="Identifier">$args</span>      <br &#47;>}       <br &#47;><span class="Keyword">function</span>&#160;<span class="Function">script</span>:<span class="Statement">append-lib</span> {      <br &#47;>&#160;&#160; <span class="Conditional">if</span> ( <span class="Statement">test-path</span>(<span class="String">'Env:\LIB'</span>) ) {      <br &#47;>&#160;&#160;&#160;&#160;&#160; <span class="Identifier">$env:LIB</span> += <span class="String">';'</span> + <span class="Identifier">$args</span>      <br &#47;>&#160;&#160; } <span class="Conditional">else</span> {      <br &#47;>&#160;&#160;&#160;&#160;&#160; <span class="Identifier">$env:LIB</span> = <span class="Identifier">$args</span>      <br &#47;>&#160;&#160; }      <br &#47;>}       <br &#47;><span class="Keyword">function</span>&#160;<span class="Function">script</span>:<span class="Statement">append-include</span> {       <br &#47;>&#160;&#160; <span class="Conditional">if</span> ( <span class="Statement">test-path</span>(<span class="String">'Env:\INCLUDE'</span>) ) {      <br &#47;>&#160;&#160;&#160;&#160;&#160; <span class="Identifier">$env:INCLUDE</span> += <span class="String">';'</span> + <span class="Identifier">$args</span>      <br &#47;>&#160;&#160; } <span class="Conditional">else</span> {      <br &#47;>&#160;&#160;&#160;&#160;&#160; <span class="Identifier">$env:INCLUDE</span> = <span class="Identifier">$args</span>      <br &#47;>&#160;&#160; }      <br &#47;>}       <br &#47;><span class="Keyword">function</span>&#160;<span class="Function">script</span>:<span class="Statement">get-vsdir</span>(<span class="Type">[string]</span>&#160;<span class="Identifier">$version</span>) {      <br &#47;>&#160;&#160; <span class="Identifier">$regpath</span> = <span class="String">"HKLM:SOFTWARE\Microsoft\VisualStudio\$version"</span>      <br &#47;>&#160;&#160; <span class="Conditional">if</span> ( <span class="Statement">test-path</span>(<span class="Identifier">$regpath</span>) ) {      <br &#47;>&#160;&#160;&#160;&#160;&#160; <span class="Identifier">$regKey</span> = <span class="Statement">get-itemproperty</span>&#160;<span class="Identifier">$regpath</span>      <br &#47;>&#160;&#160;&#160;&#160;&#160; <span class="Keyword">return</span>&#160;<span class="Identifier">$regkey</span>.InstallDir      <br &#47;>&#160;&#160; }      <br &#47;>&#160;&#160; <span class="Keyword">return</span>&#160;<span class="Identifier">$null</span>      <br &#47;>}      <br &#47;><span class="Keyword">function</span>&#160;<span class="Function">script</span>:<span class="Statement">set-vsenv</span>(<span class="Type">[string]</span>&#160;<span class="Identifier">$version</span>) {      <br &#47;>&#160;&#160; <span class="Identifier">$VSDIR</span> = (<span class="Statement">get-vsdir</span>&#160;<span class="Identifier">$version</span>)      <br &#47;>&#160;&#160; <span class="Conditional">if</span> ( <span class="Identifier">$VSDIR</span> -<span class="Operator">ne</span>&#160;<span class="Identifier">$null</span> ) {      <br &#47;>&#160;&#160;&#160;&#160;&#160; <span class="Statement">append-path</span>&#160;<span class="Identifier">$VSDIR</span>      <br &#47;>&#160;&#160;&#160;&#160;&#160; <span class="Statement">append-path</span>&#160;<span class="String">"$VSDIR..\..\VC\bin"</span>      <br &#47;>&#160;&#160;&#160;&#160;&#160; <span class="Statement">append-path</span>&#160;<span class="String">"$VSDIR..\Tools"</span>      <br &#47;>&#160;&#160;&#160;&#160;&#160;&#160; <br &#47;>&#160;&#160;&#160;&#160;&#160; <span class="Statement">append-include</span>&#160;<span class="String">"$VSDIR..\..\VC\include"</span>      <br &#47;>&#160;&#160;&#160;&#160;&#160; <span class="Statement">append-lib</span>&#160;<span class="String">"$VSDIR..\..\VC\lib"</span>      <br &#47;>&#160;&#160;&#160;&#160;&#160; <span class="Keyword">return</span>&#160;<span class="Identifier">$true</span>      <br &#47;>&#160;&#160; }      <br &#47;>&#160;&#160; <span class="Keyword">return</span>&#160;<span class="Identifier">$false</span>      <br &#47;>}      <br &#47;><span class="Keyword">function</span>&#160;<span class="Function">script</span>:<span class="Statement">get-psdkdir</span> {      <br &#47;>&#160;&#160; <span class="Identifier">$regpath</span> = <span class="String">"HKLM:SOFTWARE\Microsoft\Microsoft SDKs\Windows\"</span>      <br &#47;>&#160;&#160; <span class="Conditional">if</span> ( <span class="Statement">test-path</span>(<span class="Identifier">$regpath</span>) ) {      <br &#47;>&#160;&#160;&#160;&#160;&#160; <span class="Identifier">$regKey</span> = <span class="Statement">get-itemproperty</span>&#160;<span class="Identifier">$regpath</span>      <br &#47;>&#160;&#160;&#160;&#160;&#160; <span class="Keyword">return</span>&#160;<span class="Identifier">$regkey</span>.CurrentInstallFolder      <br &#47;>&#160;&#160; }      <br &#47;>&#160;&#160; <span class="Keyword">return</span>&#160;<span class="Identifier">$null</span>      <br &#47;>}      <br &#47;><span class="Keyword">function</span>&#160;<span class="Function">script</span>:<span class="Statement">set-psdkenv</span> {      <br &#47;>&#160;&#160; <span class="Identifier">$sdkdir</span> = (<span class="Statement">get-psdkdir</span>)      <br &#47;>&#160;&#160; <span class="Conditional">if</span> ( (<span class="Identifier">$sdkdir</span> -<span class="Operator">ne</span>&#160;<span class="Identifier">$null</span>) -<span class="Operator">and</span> (<span class="Statement">test-path</span>&#160;<span class="Identifier">$sdkdir</span>) ) {      <br &#47;>&#160;&#160;&#160;&#160;&#160; <span class="Statement">append-path</span>&#160;<span class="String">"$sdkdir\bin"</span>      <br &#47;>&#160;&#160;&#160;&#160;&#160; <span class="Conditional">if</span> ( <span class="Statement">test-path</span>&#160;<span class="String">"$sdkdir\include"</span> ) {       <br &#47;>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="Statement">append-include</span>&#160;<span class="String">"$sdkdir\include"</span>&#160; <br &#47;>&#160;&#160;&#160;&#160;&#160; }      <br &#47;>&#160;&#160;&#160;&#160;&#160; <span class="Conditional">if</span> ( <span class="Statement">test-path</span>&#160;<span class="String">"$sdkdir\lib"</span> ) {      <br &#47;>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="Statement">append-lib</span>&#160;<span class="String">"$sdkdir\lib"</span>      <br &#47;>&#160;&#160;&#160;&#160;&#160; }      <br &#47;>&#160;&#160; }      <br &#47;>}      <br &#47;>      <br &#47;><span class="Statement">set-psdkenv</span>      <br &#47;><span class="Comment"># if .NET 3.5 is installed, default to that, otherwise use 2.0</span>      <br &#47;><span class="Conditional">if</span> ( <span class="Statement">test-path</span>(<<br />
span class="Identifier">$FX35</span>) ) {      <br &#47;>&#160;&#160; <span class="Statement">append-path</span>&#160;<span class="Identifier">$FX35</span>      <br &#47;>}      <br &#47;><span class="Statement">append-path</span>&#160;<span class="Identifier">$FX20</span>      <br &#47;><span class="Conditional">if</span> ( -<span class="Operator">not</span> (<span class="Statement">set-vsenv</span>&#160;<span class="String">"9.0"</span>) ) {      <br &#47;>&#160;&#160; <span class="Type">[void]</span> (<span class="Statement">set-vsenv</span>&#160;<span class="String">"8.0"</span>)      <br &#47;>} </code></div>
<p>Feel free to customize as you see fit :-).</p>
<div class="wlWriterSmartContent" id="scid:0767317B-992E-4b12-91E0-4F059A8CECA8:c786306e-9d21-451b-b0ae-42c5c5a4939e" style="padding-right: 0px; display: inline; padding-left: 0px; padding-bottom: 0px; margin: 0px; padding-top: 0px">Technorati tags: <a href="http:&#47;&#47;technorati.com&#47;tags&#47;PowerShell" rel="tag">PowerShell</a>, <a href="http:&#47;&#47;technorati.com&#47;tags&#47;Visual%20Studio" rel="tag">Visual Studio</a>, <a href="http:&#47;&#47;technorati.com&#47;tags&#47;.NET" rel="tag">.NET</a></div><!--end_raw--></p>
