---
layout: post
status: publish
published: true
title: Redirecting through TcpTrace with WSE and WCF
author:
  display_name: Tomas Restrepo
  login: tomasr
  email: tomas@winterdom.com
  url: http://winterdom.com/
author_login: tomasr
author_email: tomas@winterdom.com
author_url: http://winterdom.com/
wordpress_id: 836
wordpress_url: http://winterdom.com/2006/04/redirectingthroughtcptracewithwseandwcf
date: '2006-04-17 09:43:16 +0000'
date_gmt: '2006-04-17 09:43:16 +0000'
categories:
- WCF
- WinFX
- Web Services
tags: []
comments: []
---
<p><!--start_raw-->
<p>Just posting this so that I can find it again: I tend to rely heavily on Simon Fell's TcpTrace utility when testing and diagnosing Web Services, so with WSE and WCF there's usually a need to write some code in the client to have the client-side proxy call the server through TcpTrace correctly. Here's the code for both scenarios:</p></p>
<p><strong>WSE</strong></p></p>
<p>Just change the destination EndpointReference&nbsp;to include a Via URL:</p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: teal; font-family: Consolas;">Uri</span><span style="font-size: 10pt; font-family: Consolas;"><font color="#373737"> serviceUri </font><span style="color: blue;">=</span><font color="#373737"> <span style="color: maroon;">"http:&#47;&#47;localhost:8080&#47;TypeInfo&#47;TypeSvc.asmx"</span></font><font color="#373737">;<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: teal; font-family: Consolas;">Uri</span><span style="font-size: 10pt; font-family: Consolas;"><font color="#373737"> tcpTraceUri </font><span style="color: blue;">=</span><font color="#373737"> </font><span style="color: maroon;">"http:&#47;&#47;localhost:8080&#47;TypeInfo&#47;TypeSvc.asmx"</span><font color="#373737">;<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><font color="#373737">proxy</font><span style="color: blue;">.</span><font color="#373737">Destination </font><span style="color: blue;">=</span><font color="#373737"> </font><span style="color: blue;">new</span><font color="#373737"> EndpointReference(serviceUri, tcpTraceUri);<o:p></o:p></font></span></p></p>
<p><strong>WCF (as of Feb06 CTP)</strong></p></p>
<p>Just add a new Via behavior (from System.ServiceModel.Description) to the service endpoint:</p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: teal; font-family: Consolas;">TypeInfoServiceContractProxy</span><span style="font-size: 10pt; font-family: Consolas;"><font color="#373737"> proxy </font><span style="color: blue;">=</span><font color="#373737"> </font><span style="color: blue;">new</span><font color="#373737"> </font><span style="color: teal;">TypeInfoServiceContractProxy</span><font color="#373737">();<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: teal; font-family: Consolas;">Uri</span><span style="font-size: 10pt; font-family: Consolas;"><font color="#373737"> tcpTraceUri </font><span style="color: blue;">=</span><font color="#373737"> </font><span style="color: blue;">new</span><font color="#373737"> </font><span style="color: teal;">Uri</span><font color="#373737">(</font><span style="color: maroon;">"http:&#47;&#47;localhost:8080&#47;TypeInfo"</span><font color="#373737">);<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; font-family: Consolas;"><font color="#373737">proxy</font><span style="color: blue;">.</span><font color="#373737">Endpoint</font><span style="color: blue;">.</span><font color="#373737">Behaviors</font><span style="color: blue;">.</span><font color="#373737">Add(</font><span style="color: blue;">new</span><font color="#373737"> </font><span style="color: teal;">ViaUriBehavior</span><font color="#373737">(tcpTraceUri));<o:p></o:p></font></span></p></p>
<p>I think I like WCF's way of doing it a little bit more. Though it is not as obvious at first, it seems very logical and fits the overall model, at least imho.</p></p>
<p><strong>Update:</strong></p></p>
<p>I hadn't noticed that <a href="http:&#47;&#47;pluralsight.com&#47;blogs&#47;aaron&#47;">Aaron Skonnard</a> had also <a href="http:&#47;&#47;pluralsight.com&#47;blogs&#47;aaron&#47;archive&#47;2006&#47;04&#47;17&#47;21870.aspx">blogged</a> about how to do this for WCF by changing the server-side configuration here. Also, here's to how to do it on the client-side using configuration as well:</p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: blue; font-family: Consolas;"><span style="">&nbsp;</span><</span><span style="font-size: 10pt; color: maroon; font-family: Consolas;">behaviors</span><span style="font-size: 10pt; color: blue; font-family: Consolas;">><o:p></o:p></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: blue; font-family: Consolas;"><span style="">&nbsp;&nbsp;&nbsp; </span><</span><span style="font-size: 10pt; color: maroon; font-family: Consolas;">behavior</span><span style="font-size: 10pt; color: blue; font-family: Consolas;"> </span><span style="font-size: 10pt; color: red; font-family: Consolas;">name</span><span style="font-size: 10pt; color: blue; font-family: Consolas;">=</span><span style="font-size: 10pt; font-family: Consolas;"><font color="#373737">"</font><span style="color: blue;">tcpTraceBehavior</span><font color="#373737">"</font><span style="color: blue;">><o:p></o:p></span></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: blue; font-family: Consolas;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><</span><span style="font-size: 10pt; color: maroon; font-family: Consolas;">channelViaUri</span><span style="font-size: 10pt; color: blue; font-family: Consolas;"> </span><span style="font-size: 10pt; color: red; font-family: Consolas;">viaUri</span><span style="font-size: 10pt; color: blue; font-family: Consolas;">=</span><span style="font-size: 10pt; font-family: Consolas;"><font color="#373737">"</font><span style="color: blue;">http:&#47;&#47;localhost:8080&#47;TypeInfo</span><font color="#373737">"</font><span style="color: blue;">&#47;><o:p></o:p></span></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: blue; font-family: Consolas;"><span style="">&nbsp;&nbsp;&nbsp; </span></</span><span style="font-size: 10pt; color: maroon; font-family: Consolas;">behavior</span><span style="font-size: 10pt; color: blue; font-family: Consolas;">><o:p></o:p></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: blue; font-family: Consolas;"><span style="">&nbsp;</span></</span><span style="font-size: 10pt; color: maroon; font-family: Consolas;">behaviors</span><span style="font-size: 10pt; color: blue; font-family: Consolas;">><o:p></o:p></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: blue; font-family: Consolas;"><span style="">&nbsp; </span><</span><span style="font-size: 10pt; color: maroon; font-family: Consolas;">client</span><span style="font-size: 10pt; color: blue; font-family: Consolas;">><o:p></o:p></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: blue; font-family: Consolas;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span><</span><span style="font-size: 10pt; color: maroon; font-family: Consolas;">endpoint</span><span style="font-size: 10pt; color: blue; font-family: Consolas;"> </span><span style="font-size: 10pt; color: red; font-family: Consolas;">address</span><span style="font-size: 10pt; color: blue; font-family: Consolas;">=</span><span style="font-size: 10pt; font-family: Consolas;"><font color="#373737">"</font><span style="color: blue;">http:&#47;&#47;localhost:81&#47;TypeInfo</span><font color="#373737">"</font><span style="color: blue;"> </span><span style="color: red;">binding</span><span style="color: blue;">=</span><font color="#373737">"</font><span style="color: blue;">wsHttpBinding</span><font color="#373737">"<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: blue; font-family: Consolas;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 10pt; color: red; font-family: Consolas;">bindingConfiguration</span><span style="font-size: 10pt; color: blue; font-family: Consolas;">=</span><span style="font-size: 10pt; font-family: Consolas;"><font color="#373737">"</font><span style="color: blue;">WSHttpBinding_TypeInfoServiceContract2</span><font color="#373737">"<o:p></o:p></font></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: blue; font-family: Consolas;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 10pt; color: red; font-family: Consolas;">contract</span><span style="font-size: 10pt; color: blue; font-family: Consolas;">=</span><span style="font-size: 10pt; font-family: Consolas;"><font color="#373737">"</font><span style="color: blue;">IndigoClient.TypeInfo.TypeInfoServiceContract</span><font color="#373737">"</font><span style="color: blue;"> <o:p></o:p></span></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: blue; font-family: Consolas;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 10pt; color: red; font-family: Consolas;">name</span><span style="font-size: 10pt; color: blue; font-family: Consolas;">=</span><span style="font-size: 10pt; font-family: Consolas;"><font color="#373737">"</font><span style="color: blue;">WSHttpBinding_TypeInfoServiceContract</span><font color="#373737">"</font><span style="color: blue;"> <o:p></o:p></span></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: blue; font-family: Consolas;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><font color="#000000"><span style="font-size: 10pt; color: red; font-family: Consolas;">behaviorConfiguration</span><span style="font-size: 10pt; color: blue; font-family: Consolas;">=</span><span style="font-size: 10pt; font-family: Consolas;">"<span style="color: blue;">tcpTraceBehavior</span>"<o:p></o:p></span></font></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: blue; font-family: Consolas;"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>&#47;><o:p></o:p></span></p></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-size: 10pt; color: blue; font-family: Consolas;"><span style="">&nbsp; </span></</span><span style="font-size: 10pt; color: maroon; font-family: Consolas;">client</span><span style="font-size: 10pt; color: blue; font-family: Consolas;">><o:p></o:p></span></p></p>
<p>&nbsp;</p><!--end_raw--></p>
