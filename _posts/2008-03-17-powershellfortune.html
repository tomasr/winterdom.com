---
layout: post
status: publish
published: true
title: PowerShell Fortune
author:
  display_name: Tomas Restrepo
  login: tomasr
  email: tomas@winterdom.com
  url: http://winterdom.com/
author_login: tomasr
author_email: tomas@winterdom.com
author_url: http://winterdom.com/
wordpress_id: 955
wordpress_url: http://winterdom.com/2008/03/powershellfortune
date: '2008-03-17 06:27:33 +0000'
date_gmt: '2008-03-17 06:27:33 +0000'
categories:
- PowerShell
tags: []
comments: []
---
<p><!--start_raw-->
<p>The first version of Linux I ever used was Slackware 2.3 running one of those pesky 1.X kernels. Since then, one of my all-time favorite utilities has been the <a href="http:&#47;&#47;en.wikipedia.org&#47;wiki&#47;Fortune_%28Unix%29">Fortune</a> program, which displays quotes on the console when run. </p>
<p><a href="&#47;weblog&#47;content&#47;binary&#47;WindowsLiveWriter&#47;PowerShellFortune_74E5&#47;fortune_4.png"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="339" alt="fortune" src="&#47;weblog&#47;content&#47;binary&#47;WindowsLiveWriter&#47;PowerShellFortune_74E5&#47;fortune_thumb_1.png" width="708" border="0" &#47;></a> </p>
<p>I've always missed it on windows and even build (and lost) a clone of it myself once, but I'm too lazy now to try that again. Instead, this time around I simply settled for writing a simple PowerShell script that grabs a random quote from <a href="http:&#47;&#47;www.quotedb.com&#47;">QuoteDB</a>. It's not fancy. It has no error checking at all. It's slow (depending on your network connection and how loaded quotedb is), but alas, it works and it's fun to use.</p>
<p>I give you fortune.ps1:</p>
<div class='codebg'><code><span class="Identifier">$wc</span>&nbsp;= <span class="Statement">new-object</span>&nbsp;net.webclient<br &#47;> <span class="Identifier">$js</span>&nbsp;= <span class="Identifier">$wc</span>.DownloadString(<span class="String">'<a href="http:&#47;&#47;www.quotedb.com&#47;quote&#47;quote.php?action=random_quote&amp;=&amp;=&amp;">http:&#47;&#47;www.quotedb.com&#47;quote&#47;quote.php?action=random_quote&amp;=&amp;=&amp;</a>'</span>)<br &#47;> <br &#47;> <span class="Keyword">function</span>&nbsp;<span class="Function">strip-html</span>(<span class="Type">[string]</span>&nbsp;<span class="Identifier">$str</span>) {<br &#47;> &nbsp;&nbsp; <span class="Identifier">$val</span>&nbsp;= <span class="Identifier">$str</span>&nbsp;-<span class="Operator">replace</span>&nbsp;<span class="String">'<[^>]+>'</span>, <span class="String">''</span><br &#47;> &nbsp;&nbsp; <span class="Identifier">$val</span>&nbsp;= <span class="Identifier">$val</span>&nbsp;-<span class="Operator">replace</span>&nbsp;<span class="String">'`'</span>, <span class="String">"'"</span><br &#47;> &nbsp;&nbsp; <span class="Keyword">return</span>&nbsp;<span class="Identifier">$val</span><br &#47;> }<br &#47;> <br &#47;> <span class="Keyword">function</span>&nbsp;<span class="Function">next-word</span>(<span class="Type">[string]</span>&nbsp;<span class="Identifier">$text</span>, <span class="Type">[int]</span>&nbsp;<span class="Identifier">$start</span>) {<br &#47;> &nbsp;&nbsp; <span class="Identifier">$end</span>&nbsp;= <span class="Identifier">$start</span><br &#47;> &nbsp;&nbsp; <span class="Repeat">for</span>&nbsp;( ; <span class="Identifier">$end</span>&nbsp;-<span class="Operator">lt</span>&nbsp;<span class="Identifier">$text</span>.Length; <span class="Identifier">$end</span>&nbsp;+= <span class="Number">1</span>&nbsp;) {<br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Conditional">if</span>&nbsp;( <span class="Identifier">$text</span>[<span class="Identifier">$end</span>] -<span class="Operator">eq</span>&nbsp;<span class="String">' '</span>&nbsp;) {<br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="Repeat">break</span><br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br &#47;> &nbsp;&nbsp; }<br &#47;> &nbsp;&nbsp; <span class="Keyword">return</span>&nbsp;<span class="Identifier">$text</span>.Substring(<span class="Identifier">$start</span>, <span class="Identifier">$end</span>&nbsp;-&nbsp;<span class="Identifier">$start</span>)<br &#47;> }<br &#47;> <br &#47;> <span class="Keyword">function</span>&nbsp;<span class="Function">wrap-text</span>(<span class="Type">[string]</span>&nbsp;<span class="Identifier">$text</span>) {<br &#47;> &nbsp;&nbsp; <span class="Identifier">$buf</span>&nbsp;= <span class="Statement">new-object</span>&nbsp;Text.StringBuilder<br &#47;> &nbsp;&nbsp; <span class="Identifier">$lnl</span>&nbsp;= <span class="Identifier">$host</span>.UI.RawUI.WindowSize.Width -&nbsp;<span class="Number">2</span><br &#47;> &nbsp;&nbsp; <span class="Identifier">$pos</span>&nbsp;= <span class="Number">0</span><br &#47;> &nbsp;&nbsp; <span class="Identifier">$linepos</span>&nbsp;= <span class="Number">0</span><br &#47;> &nbsp;&nbsp; <span class="Repeat">while</span>&nbsp;( <span class="Identifier">$pos</span>&nbsp;-<span class="Operator">lt</span>&nbsp;<span class="Identifier">$text</span>.Length ) {<br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Identifier">$word</span>&nbsp;= (<span class="Statement">next-word</span>&nbsp;<span class="Identifier">$text</span>&nbsp;<span class="Identifier">$pos</span>)<br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Conditional">if</span>&nbsp;( <span class="Identifier">$linepos</span>&nbsp;+ <span class="Identifier">$word</span>.Length -<span class="Operator">gt</span>&nbsp;<span class="Identifier">$lnl</span>&nbsp;) {<br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="Type">[void]</span>&nbsp;<span class="Identifier">$buf</span>.Append(<span class="String">"`n"</span>)<br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="Identifier">$linepos</span>&nbsp;= <span class="Number">0</span><br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Type">[void]</span>&nbsp;<span class="Identifier">$buf</span>.Append(<span class="Identifier">$word</span>&nbsp;+ <span class="String">' '</span>)<br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Identifier">$pos</span>&nbsp;+= <span class="Identifier">$word</span>.Length + <span class="Number">1</span><br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Identifier">$linepos</span>&nbsp;+= <span class="Identifier">$word</span>.Length + <span class="Number">1</span><br &#47;> &nbsp;&nbsp; }<br &#47;> &nbsp;&nbsp; write <span class="Identifier">$buf</span>.ToString()<br &#47;> }<br &#47;> <br &#47;> <br &#47;> <span class="Conditional">if</span>&nbsp;( <span class="Identifier">$js</span>&nbsp;-<span class="Operator">ne</span>&nbsp;<span class="Identifier">$null</span>&nbsp;) {<br &#47;> &nbsp;&nbsp; <span class="Identifier">$js</span>&nbsp;= <span class="Identifier">$js</span>.trim()<br &#47;> &nbsp;&nbsp; <span class="Identifier">$p1</span>&nbsp;= <span class="String">"^.+'(?<text>.+)<br>'\);"</span><br &#47;> &nbsp;&nbsp; <span class="Identifier">$p2</span>&nbsp;= <span class="String">'">(?<author>.+)</a>'</span><br &#47;> <br &#47;> &nbsp;&nbsp; <span class="Identifier">$authorline</span>&nbsp;= <span class="Identifier">$js</span>.Substring(<span class="Identifier">$js</span>.LastIndexOf(<span class="String">"`n"</span>))<br &#47;> &nbsp;&nbsp; <span class="Identifier">$maintext</span>&nbsp;= <span class="Identifier">$js</span>.Substring(<span class="Number">0</span>, <span class="Identifier">$js</span>.LastIndexOf(<span class="String">"`n"</span>))<br &#47;> &nbsp;&nbsp; <span class="Conditional">if</span>&nbsp;( <span class="Identifier">$maintext</span>&nbsp;-<span class="Operator">match</span>&nbsp;<span class="Identifier">$p1</span>&nbsp;) {<br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Identifier">$matches</span>.text.Split(<span class="String">"`n"</span>) | %{ <br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="Statement">wrap-text</span>&nbsp;(<span class="Statement">strip-html</span>&nbsp;<span class="Identifier">$_</span>) <br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br &#47;> &nbsp;&nbsp; }<br &#47;> &nbsp;&nbsp; <span class="Conditional">if</span>&nbsp;( <span class="Identifier">$authorline</span>&nbsp;-<span class="Operator">match</span>&nbsp;<span class="Identifier">$p2</span>&nbsp;) {<br &#47;> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write <span class="String">"`t`t-- $($matches.author)"</span><br &#47;> &nbsp;&nbsp; }<br &#47;> } </code></div>
<div class="wlWriterSmartContent" id="scid:0767317B-992E-4b12-91E0-4F059A8CECA8:22078561-759d-491a-885d-aa5e3931c14a" style="padding-right: 0px; display: inline; padding-left: 0px; padding-bottom: 0px; margin: 0px; padding-top: 0px">Technorati tags: <a href="http:&#47;&#47;technorati.com&#47;tags&#47;Fortune"<br />
rel="tag">Fortune</a>, <a href="http:&#47;&#47;technorati.com&#47;tags&#47;PowerShell" rel="tag">PowerShell</a></div><!--end_raw--></p>
