---
layout: post
status: publish
published: true
title: Controlling BizTalk Orchestrations with PowerShell
author:
  display_name: Tomas Restrepo
  login: tomasr
  email: tomas@winterdom.com
  url: http://winterdom.com/
author_login: tomasr
author_email: tomas@winterdom.com
author_url: http://winterdom.com/
wordpress_id: 707
wordpress_url: http://winterdom.com/2008/06/controllingbiztalkorchestrationswithpowershell
date: '2008-06-26 08:04:47 +0000'
date_gmt: '2008-06-26 08:04:47 +0000'
categories:
- BizTalk
- PowerShell
tags: []
comments:
- id: 477
  author: Leonid Ganeline
  author_email: ''
  author_url: http://geekswithblogs.net/leonidganeline/Default.aspx
  date: '2008-07-02 08:31:51 +0000'
  date_gmt: '2008-07-02 08:31:51 +0000'
  content: |
    Cool!
    Tomas, I've added it to my BizTalk script collection.
    Set PowerShell to the BizTalk and got a powerful system!
- id: 815
  author: Germ&aacute;n
  author_email: gotalvaro@gmail.com
  author_url: ''
  date: '2009-05-21 14:45:08 +0000'
  date_gmt: '2009-05-21 14:45:08 +0000'
  content: "Excelente Tom&aacute;s.\r\n\r\nPor aca en Madrid estamos usando estos
    scripts, espero que el Valle de Aburra todo este bien.\r\n\r\nGerm&aacute;n O."
---
<p><!--start_raw-->
<p>Here's a sample PowerShell script&#47;functions to start&#47;stop BizTalk orchestrations. This is an extended version of the Stop-Orchestration VBScript included in the BizTalk 2006 SDK, which I hope someone finds useful :-).</p>
<p>The script can be used to start or stop either a specific orchestration or a group of orchestrations defined in a BizTalk assembly. For example, to stop and unenlist all orchestrations in a given assembly, you could use this:</p>
<div class="codebg"><code><span class="Statement">stop-orch</span> -assembly <span class="String">'MyProject.BizTalk, Version=1.0.0.0, Culture=neutral, PublicKeyToken=50b7b2906e3f8aa5'</span> -unenlist </code></div>
<p>Here's the code for the script:</p>
<div class="codebg"><code><span class="Identifier">$</span><span class="Type">script</span><span class="Identifier">:bound</span> = <span class="Number">2</span>      <br &#47;><span class="Identifier">$</span><span class="Type">script</span><span class="Identifier">:started</span> = <span class="Number">4</span>      <br &#47;><span class="Identifier">$</span><span class="Type">script</span><span class="Identifier">:controlRecvLoc</span> = <span class="Number">2</span>      <br &#47;><span class="Identifier">$</span><span class="Type">script</span><span class="Identifier">:controlInst</span> = <span class="Number">2</span>      <br &#47;>      <br &#47;><span class="Keyword">function</span>&#160;<span class="Function">script</span>:<span class="Statement">get-assemblyfilter</span>(<span class="Type">[string]</span><span class="Identifier">$assembly</span>) {      <br &#47;>&#160;&#160; <span class="Comment"># The BizTalk WMI provider uses separate properties for each</span>      <br &#47;>&#160;&#160; <span class="Comment"># part of the assembly name, so break it up to make it easier to handle</span>      <br &#47;>&#160;&#160; <span class="Identifier">$parts</span> = <span class="Identifier">$assembly</span>.Split((<span class="String">','</span>, <span class="String">'='</span>))      <br &#47;>&#160;&#160; <span class="Identifier">$filter</span> = <span class="String">"AssemblyName='$($parts[0])'"</span>      <br &#47;>&#160;&#160; <span class="Conditional">if</span> ( <span class="Identifier">$parts</span>.Count -<span class="Operator">gt</span>&#160;<span class="Number">1</span> ) {      <br &#47;>&#160;&#160;&#160;&#160;&#160; <span class="Repeat">for</span> ( <span class="Identifier">$i</span>=<span class="Number">1</span>; <span class="Identifier">$i</span> -<span class="Operator">lt</span>&#160;<span class="Identifier">$parts</span>.Count; <span class="Identifier">$i</span> += <span class="Number">2</span> ) {      <br &#47;>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="Identifier">$filter</span> = <span class="String">"$filter and Assembly$($parts[$i].trim())='$($parts[$i+1])'"</span>      <br &#47;>&#160;&#160;&#160;&#160;&#160; }      <br &#47;>&#160;&#160; }      <br &#47;>&#160;&#160; <span class="Keyword">return</span>&#160;<span class="Identifier">$filter</span>      <br &#47;>}      <br &#47;><span class="Keyword">function</span>&#160;<span class="Function">script</span>:<span class="Statement">find-orch</span>(<span class="Type">[string]</span><span class="Identifier">$name</span>, <span class="Type">[string]</span><span class="Identifier">$assembly</span>) {      <br &#47;>&#160;&#160; <span class="Comment"># We want to be able to find orchestrations by</span>      <br &#47;>&#160;&#160; <span class="Comment"># name and&#47;or assembly. That way we can control</span>      <br &#47;>&#160;&#160; <span class="Comment"># all orchestrations in a single assembly in one call</span>      <br &#47;>&#160;&#160; <span class="Identifier">$filter</span> = <span class="String">""</span>      <br &#47;>&#160;&#160; <span class="Conditional">if</span> ( !<span class="Type">[String]</span>::IsNullOrEmpty(<span class="Identifier">$name</span>) ) {      <br &#47;>&#160;&#160;&#160;&#160;&#160; <span class="Identifier">$filter</span> = <span class="String">"Name='$name'"</span>      <br &#47;>&#160;&#160;&#160;&#160;&#160; <span class="Conditional">if</span> ( !<span class="Type">[String]</span>::IsNullOrEmpty(<span class="Identifier">$assembly</span>) ) {      <br &#47;>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="Identifier">$filter</span> = <span class="String">"$filter and $(get-assemblyfilter $assembly)"</span>      <br &#47;>&#160;&#160;&#160;&#160;&#160; }      <br &#47;>&#160;&#160; } <span class="Conditional">else</span> {      <br &#47;>&#160;&#160;&#160;&#160;&#160; <span class="Identifier">$filter</span> = $(<span class="Statement">get-assemblyfilter</span>&#160;<span class="Identifier">$assembly</span>)      <br &#47;>&#160;&#160; }      <br &#47;>&#160;&#160; <span class="Statement">get-wmiobject</span> MSBTS_Orchestration `      <br &#47;>&#160;&#160;&#160;&#160;&#160; -namespace <span class="String">'root\MicrosoftBizTalkServer'</span> `      <br &#47;>&#160;&#160;&#160;&#160;&#160; -<span class="Keyword">filter</span>&#160;<span class="Identifier">$filter</span>      <br &#47;>}      <br &#47;>      <br &#47;><span class="Keyword">function</span>&#160;<span class="Function">start-orch</span>(<span class="Type">[string]</span><span class="Identifier">$name</span>, <span class="Type">[string]</span><span class="Identifier">$assembly</span>) {      <br &#47;>&#160;&#160; <span class="Identifier">$orch</span> = (<span class="Statement">find-orch</span>&#160;<span class="Identifier">$name</span>&#160;<span class="Identifier">$assembly</span>)      <br &#47;>&#160;&#160; <span class="Identifier">$orch</span> | ?{ <span class="Identifier">$_</span>.OrchestrationStatus -<span class="Operator">eq</span>&#160;<span class="Identifier">$bound</span> } | %{      <br &#47;>&#160;&#160;&#160;&#160;&#160; <span class="Statement">write-host</span>&#160;<span class="String">"Enlisting $($_.Name)..."</span>      <br &#47;>&#160;&#160;&#160;&#160;&#160; <span class="Type">[void]</span><span class="Identifier">$_</span>.Enlist()      <br &#47;>&#160;&#160; }      <br &#47;>&#160;&#160; <span class="Identifier">$orch</span> | ?{ <span class="Identifier">$_</span>.OrchestrationStatus -<span class="Operator">ne</span>&#160;<span class="Identifier">$started</span> } | %{      <br &#47;>&#160;&#160;&#160;&#160;&#160; <span class="Statement">write-host</span>&#160;<span class="String">"Starting $($_.Name)..."</span>      <br &#47;>&#160;&#160;&#160;&#160;&#160; <span class="Type">[void]</span><span class="Identifier">$_</span>.Start(<span class="Identifier">$controlRecvLoc</span>, <span class="Identifier">$controlInst</span>)      <br &#47;>&#160;&#160; }      <br &#47;>}      <br &#47;>      <br &#47;><span class="Keyword">function</span>&#160;<span class="Function">stop-orch</span>(<span class="Type">[string]</span><span class="Identifier">$name</span>, <span class="Type">[string]</span><span class="Identifier">$assembly</span>, <span class="Type">[switch]</span><span class="Identifier">$unenlist</span> = <span class="Identifier">$false</span>) {      <br &#47;>&#160;&#160; <span class="Identifier">$orch</span> = (<span class="Statement">find-orch</span>&#160;<span class="Identifier">$name</span>&#160;<span class="Identifier">$assembly</span>)      <br &#47;>&#160;&#160; <span class="Identifier">$orch</span> | ?{ <span class="Identifier">$_</span>.OrchestrationStatus -<span class="Operator">eq</span>&#160;<span class="Identifier">$started</span> } | %{      <br &#47;>&#160;&#160;&#160;&#160;&#160; <span class="Statement">write-host</span>&#160;<span class="String">"Stopping $($_.Name)..."</span>      <br &#47;>&#160;&#160;&#160;&#160;&#160; <span class="Type">[void]</span><span class="Identifier">$_</span>.Stop(<span class="Identifier">$controlRecvLoc</span>, <span class="Identifier">$controlInst</span>)      <br &#47;>&#160;&#160;&#160;&#160;&#160; <span class="Conditional">if</span> ( <span class="Identifier">$unenlist</span> ) {      <br &#47;>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="Type">[void]</span><span class="Identifier">$_</span>.Unenlist()      <br &#47;>&#160;&#160;&#160;&#160;&#160; }      <br &#47;>&#160;&#160; }      <br &#47;>}</code></div>
<div class="wlWriterSmartContent" id="scid:0767317B-992E-4<br />
b12-91E0-4F059A8CECA8:f2ca6518-4843-48e8-a495-c25c7a227cb7" style="padding-right: 0px; display: inline; padding-left: 0px; padding-bottom: 0px; margin: 0px; padding-top: 0px">Technorati tags: <a href="http:&#47;&#47;technorati.com&#47;tags&#47;BizTalk%20Server%202006" rel="tag">BizTalk Server 2006</a>, <a href="http:&#47;&#47;technorati.com&#47;tags&#47;PowerShell" rel="tag">PowerShell</a></div><!--end_raw--></p>
